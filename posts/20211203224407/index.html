<!DOCTYPE html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="theme-color" content="rgb(46, 44, 79)">
  <meta name="description" content="Proxy ä»£ç†">
  <meta name="keywords" content="JavaScript">
  <title>
    Proxy
  </title>
  <link rel="stylesheet" href="/public/css/index.css">
  <link rel="stylesheet" href="/public/css/markdown.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
  <script src="/public/JavaScript/index.js"></script>
</head><header class="blog-header">
  <a href="https://github.com/fwqaaq" target="_blank">
    <img src="https://avatars.githubusercontent.com/u/82551626?v=4" loading="lazy" alt="me" srcset="">
  </a>
  <nav class="header-nav">
    <a class="decoration-line" href="/"><i class="fa-solid fa-house-chimney fa-xs"></i>
      <span class="disappear">Home</span>
    </a>
    <a class="decoration-line" href="/./about/index.html"><i class="fa-solid fa-address-card fa-xs"></i>
      <span class="disappear">About</span></a>
    <a class="decoration-line" href="/./archive/index.html"><i class="fa-solid fa-box-archive fa-xs"></i> <span
        class="disappear">Archive</span></a>
    <a class="decoration-line" href="/./tags/index.html"><i class="fa-solid fa-tag fa-xs"></i> <span
        class="disappear">Tag</span></a>
    <div class="toy"><i class="fa-solid fa-gamepad fa-xs"></i> <span class="disappear">Toy</span>
      <nav class="toy-nav disappear">
        <a class="decoration-line" href="/public/resume/">æˆ‘çš„ç®€å†</a>
        <a class="decoration-line" href="/public/write-css/index.html">å­¦ä¹  UI</a>
      </nav>
    </div>
    <a class="decoration-line" href="/feed.xml"><i class="fa-solid fa-rss fa-xs"></i> <span
        class="disappear">RSS</span></a>
    <a class="decoration-line model" href="#" class="model"><i class="fa-solid fa-sun fa-xs"></i></a>
  </nav>
</header><main class="blog-main">
          <article class="blog-article">
            <h1>Proxy</h1>
            <hr>
            <h2 id="proxy">Proxy<a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#proxy"></a></h2>
<blockquote>
<ul>
<li>Proxy å¯¹è±¡ç”¨äºåˆ›å»ºä¸€ä¸ªå¯¹è±¡çš„ä»£ç†ï¼Œä»è€Œå®ç°åŸºæœ¬æ“ä½œçš„æ‹¦æˆªå’Œè‡ªå®šä¹‰ (å¦‚å±æ€§æŸ¥æ‰¾ï¼Œèµ‹å€¼ï¼Œæšä¸¾ï¼Œå‡½æ•°è°ƒç”¨ç­‰)</li>
<li>ç›®æ ‡å¯¹è±¡æ—¢å¯ä»¥ç›´æ¥è¢«æ“ä½œï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä»£ç†æ¥æ“ä½œï¼Œä½†ç›´æ¥æ“ä½œä¼šç»•è¿‡ä»£ç†å®æ–½çš„è¡Œä¸º</li>
<li>proxy åœ¨ç›®æ ‡å¯¹è±¡çš„å¤–å±‚æ­å»ºäº†ä¸€å±‚æ‹¦æˆªï¼Œ<strong>å¤–ç•Œå¯¹ç›®æ ‡å¯¹è±¡çš„æŸäº›æ“ä½œï¼Œå¿…é¡»é€šè¿‡è¿™å±‚æ‹¦æˆª</strong></li>
</ul>
</blockquote>
<pre><code class="hl language-js"><span class="hl-keyword">const</span> p = <span class="hl-keyword">new</span> <span class="hl-title class_">Proxy</span>(target, handler);
</code></pre>
<ul>
<li>å‚æ•°ï¼š
<ol>
<li><code>target</code>:è¦ä½¿ç”¨ Proxy åŒ…è£…çš„ç›®æ ‡å¯¹è±¡ (å¯ä»¥æ˜¯ä»»ä½•ç±»å‹çš„å¯¹è±¡ï¼ŒåŒ…æ‹¬åŸç”Ÿæ•°ç»„ï¼Œå‡½æ•°ï¼Œç”šè‡³å¦ä¸€ä¸ªä»£ç†)</li>
<li><code>handler</code>:ä¸€ä¸ªé€šå¸¸ä»¥å‡½æ•°ä½œä¸ºå±æ€§çš„å¯¹è±¡ï¼Œå„å±æ€§ä¸­çš„å‡½æ•°åˆ†åˆ«å®šä¹‰äº†åœ¨æ‰§è¡Œå„ç§æ“ä½œæ—¶ä»£ç† p çš„è¡Œä¸º</li>
</ol>
</li>
</ul>
<h3 id="trapsæ•è·å™¨">traps(æ•è·å™¨)<a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#trapsæ•è·å™¨"></a></h3>
<blockquote>
<p>æä¾›å±æ€§è®¿é—®çš„æ–¹æ³•ï¼šæ¯ä¸ªæ•è·å™¨éƒ½å¯¹åº”ä¸€ç§åŸºæœ¬æ“ä½œï¼Œå¯ä»¥ç›´æ¥æˆ–è€…é—´æ¥åœ¨ä»£ç†å¯¹è±¡ä¸Šä½¿ç”¨</p>
<p>æ¯æ¬¡ä»£ç†å¯¹è±¡ä¸Šè°ƒç”¨è¿™äº›åŸºæœ¬æ“ä½œæ˜¯ï¼Œä»£ç†å¯ä»¥åœ¨è¿™äº›æ“ä½œä¼ æ’­åˆ°ç›®æ ‡å¯¹è±¡ä¹‹å‰<strong>å…ˆè°ƒç”¨æ•è·å™¨å‡½æ•°ï¼Œä»è€Œæ‹¦æˆªå¹¶ä¿®æ”¹ç›¸åº”çš„è¡Œä¸º</strong></p>
</blockquote>
<pre><code class="hl language-js"><span class="hl-keyword">const</span> target = {
  <span class="hl-attr">name</span>: <span class="hl-string">"zhangsan"</span>,
};
<span class="hl-keyword">const</span> handler = {
  <span class="hl-title function_">get</span>(<span class="hl-params">target, key</span>) {
    <span class="hl-variable language_">console</span>.<span class="hl-title function_">log</span>(<span class="hl-string">`<span class="hl-subst">${key}</span> è¢«è¯»å–`</span>);
    <span class="hl-keyword">return</span> target[key];
  },
  <span class="hl-title function_">set</span>(<span class="hl-params">target, key, value</span>) {
    <span class="hl-variable language_">console</span>.<span class="hl-title function_">log</span>(<span class="hl-string">`<span class="hl-subst">${key}</span> è¢«è®¾ç½®ä¸º <span class="hl-subst">${value}</span>`</span>);
    target[key] = value;
  },
};
<span class="hl-keyword">const</span> proxy = <span class="hl-keyword">new</span> <span class="hl-title class_">Proxy</span>(target, handler);
proxy.<span class="hl-property">name</span>;
<span class="hl-comment">//name è¢«è¯»å–</span>
proxy.<span class="hl-property">name</span> = <span class="hl-string">"lisi"</span>;
<span class="hl-comment">//name è¢«è®¾ç½®ä¸º lisi</span>
<span class="hl-variable language_">console</span>.<span class="hl-title function_">log</span>(target.<span class="hl-property">name</span>);
<span class="hl-comment">//lisi</span>
</code></pre>
<ol>
<li><code>proxy</code>è¯»å–å±æ€§çš„å€¼æ—¶ï¼Œå®é™…æ‰§è¡Œçš„æ˜¯<code>handler.get</code>:è¯»å–è¢«ä»£ç†å¯¹è±¡çš„<code>target</code>å±æ€§</li>
<li><code>proxy</code>è®¾ç½®å±æ€§å€¼æ—¶ï¼Œå®é™…ä¸Šæ‰§è¡Œçš„æ˜¯<code>handler.set</code>:è¯»å–è¢«ä»£ç†å¯¹è±¡<code>target</code>å±æ€§</li>
<li>ç›®æ ‡å¯¹è±¡ä¹Ÿä¼šæ”¹å˜</li>
</ol>
<h3 id="proxyrevocable">Proxy.revocable()<a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#proxyrevocable"></a></h3>
<blockquote>
<p><code>Proxy.revocable()</code>æ–¹æ³•å¯ä»¥ç”¨æ¥åˆ›å»ºä¸€ä¸ªå¯æ’¤é”€çš„ä»£ç†å¯¹è±¡</p>
</blockquote>
<ul>
<li>è¿”å›å€¼ï¼š
<ol>
<li>è¿”å›ä¸€ä¸ªåŒ…å«äº†ä»£ç†å¯¹è±¡æœ¬èº«å’Œå®ƒçš„æ’¤é”€æ–¹æ³•çš„å¯æ’¤é”€<code>Proxy</code>å¯¹è±¡</li>
<li>è¿”å›å€¼æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ç»“æ„ä¸º<code>{"proxy":proxy, "revoke":revoke}</code>
<ol>
<li><code>proxy</code>:è¡¨ç¤ºæ–°ç”Ÿæˆçš„ä»£ç†å¯¹è±¡æœ¬èº«</li>
<li><code>revole</code>:æ’¤é”€æ–¹æ³•ï¼Œè°ƒç”¨çš„æ—¶å€™ä¸éœ€è¦åŠ ä»»ä½•å‚æ•°</li>
</ol>
</li>
</ol>
</li>
</ul>
<pre><code class="hl language-js"><span class="hl-keyword">const</span> revocable = <span class="hl-title class_">Proxy</span>.<span class="hl-title function_">revocable</span>({}, {
  <span class="hl-title function_">get</span>(<span class="hl-params">target, name</span>) {
    <span class="hl-keyword">return</span> <span class="hl-string">"[["</span> + name + <span class="hl-string">"]]"</span>;
  },
});
<span class="hl-keyword">const</span> proxy = revocable.<span class="hl-property">proxy</span>;
proxy.<span class="hl-property">foo</span>; <span class="hl-comment">// "[[foo]]"</span>
revocable.<span class="hl-title function_">revoke</span>();
<span class="hl-variable language_">console</span>.<span class="hl-title function_">log</span>(proxy.<span class="hl-property">foo</span>); <span class="hl-comment">// æŠ›å‡º TypeError</span>
</code></pre>
<h3 id="handler-çš„ä»£ç†èŒƒå›´">handler çš„ä»£ç†èŒƒå›´<a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#handler-çš„ä»£ç†èŒƒå›´"></a></h3>
<h4 id="handlerhas"><strong>handler.has()</strong><a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#handlerhas"></a></h4>
<ul>
<li>åœ¨åˆ¤æ–­ä»£ç†å¯¹è±¡æ˜¯å¦æ‹¥æœ‰æŸä¸ªå±æ€§æ—¶è§¦å‘è¯¥æ“ä½œ</li>
</ul>
<blockquote>
<p>è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼</p>
</blockquote>
<ul>
<li>
<p>æ‹¦æˆªï¼š</p>
<ol>
<li>å±æ€§æŸ¥è¯¢ï¼š<code>"foo" in proxy</code></li>
<li>ç»§æ‰¿å±æ€§æŸ¥è¯¢ï¼š<code>foo in Object.create(proxy)</code></li>
<li><code>Reflect.has()</code></li>
</ol>
</li>
<li>
<p>TypeError</p>
<ol>
<li>å¦‚æœç›®æ ‡å¯¹è±¡çš„<strong>æŸä¸€å±æ€§æœ¬èº«ä¸å¯è¢«é…ç½®</strong></li>
<li>å¦‚æœç›®æ ‡å¯¹è±¡ä¸º<strong>ä¸å¯æ‰©å±•å¯¹è±¡</strong></li>
</ol>
</li>
</ul>
<pre><code class="hl language-js"><span class="hl-keyword">const</span> handler1 = {
  <span class="hl-title function_">has</span>(<span class="hl-params">target, key</span>) {
    <span class="hl-keyword">if</span> (key[<span class="hl-number">0</span>] === <span class="hl-string">"_"</span>) {
      <span class="hl-keyword">return</span> <span class="hl-literal">false</span>;
    }
    <span class="hl-keyword">return</span> key <span class="hl-keyword">in</span> target;
  },
};
<span class="hl-keyword">const</span> monster1 = {
  <span class="hl-attr">_secret</span>: <span class="hl-string">"easily scared"</span>,
  <span class="hl-attr">eyeCount</span>: <span class="hl-number">4</span>,
};
<span class="hl-keyword">const</span> proxy1 = <span class="hl-keyword">new</span> <span class="hl-title class_">Proxy</span>(monster1, handler1);
<span class="hl-variable language_">console</span>.<span class="hl-title function_">log</span>(<span class="hl-string">"eyeCount"</span> <span class="hl-keyword">in</span> proxy1); <span class="hl-comment">// true</span>
<span class="hl-variable language_">console</span>.<span class="hl-title function_">log</span>(<span class="hl-string">"_secret"</span> <span class="hl-keyword">in</span> proxy1); <span class="hl-comment">// false</span>
<span class="hl-variable language_">console</span>.<span class="hl-title function_">log</span>(<span class="hl-string">"_secret"</span> <span class="hl-keyword">in</span> monster1); <span class="hl-comment">//true</span>
</code></pre>
<ol>
<li><code>target</code>:ç›®æ ‡å¯¹è±¡</li>
<li><code>prop</code>:éœ€è¦æ£€æŸ¥æ˜¯å¦å­˜åœ¨çš„å±æ€§</li>
</ol>
<h4 id="handlerget"><strong>handler.get()</strong><a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#handlerget"></a></h4>
<ul>
<li>åœ¨è¯»å–ä»£ç†å¯¹è±¡çš„æŸä¸ªå±æ€§æ—¶è§¦å‘è¯¥æ“ä½œ</li>
</ul>
<blockquote>
<p>å¯ä»¥è¿”å›ä»»æ„å€¼</p>
</blockquote>
<ul>
<li>
<p>æ‹¦æˆªï¼š</p>
<ol>
<li>è®¿é—®å±æ€§ï¼š<code>proxy.bar</code></li>
<li>è®¿é—®åŸå‹é“¾ä¸Šçš„å±æ€§ï¼š<code>Object.create(proxy)[foo]</code></li>
<li><code>Reflect.get()</code></li>
</ol>
</li>
<li>
<p>TypeError</p>
<ol>
<li>å¦‚æœç›®æ ‡å¯¹è±¡çš„<strong>æŸä¸€å±æ€§æœ¬èº«ä¸å¯è¢«é…ç½®</strong></li>
<li>å¦‚æœè¦è®¿é—®çš„ç›®æ ‡å±æ€§æ²¡æœ‰é…ç½®è®¿é—®æ–¹æ³•ï¼Œå³ get æ–¹æ³•æ˜¯ undefined çš„ï¼Œåˆ™è¿”å›å€¼å¿…é¡»ä¸º undefined</li>
</ol>
</li>
</ul>
<pre><code class="hl language-js"><span class="hl-keyword">const</span> p = <span class="hl-keyword">new</span> <span class="hl-title class_">Proxy</span>(target, {
  <span class="hl-title function_">get</span>(<span class="hl-params">target, property, receiver</span>) {
    <span class="hl-keyword">return</span> ...
  }
})
</code></pre>
<ol>
<li><code>target</code>:ç›®æ ‡å¯¹è±¡</li>
<li><code>property</code>:è¢«è·å–çš„å±æ€§å</li>
<li><code>receiver</code>:Proxy æˆ–è€…ç»§æ‰¿ Proxy çš„å¯¹è±¡</li>
</ol>
<h4 id="handlerset"><strong>handler.set()</strong><a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#handlerset"></a></h4>
<ul>
<li>åœ¨ç»™ä»£ç†å¯¹è±¡çš„æŸä¸ªå±æ€§èµ‹å€¼æ—¶è§¦å‘è¯¥æ“ä½œ</li>
</ul>
<blockquote>
<p>é»˜è®¤è¿”å› true</p>
</blockquote>
<ul>
<li>
<p>æ‹¦æˆª</p>
<ul>
<li>æŒ‡å®šå±æ€§å€¼ï¼š<code>proxy.foo = bar</code></li>
<li>æŒ‡å®šç»§æ‰¿è€…çš„å±æ€§å€¼ï¼š<code>Object.create(proxy)[foo] = bar</code></li>
<li><code>Reflect.set()</code></li>
</ul>
</li>
<li>
<p>TypeError</p>
<ol>
<li>å¦‚æœç›®æ ‡å¯¹è±¡çš„<strong>æŸä¸€å±æ€§æœ¬èº«ä¸å¯è¢«é…ç½®</strong></li>
<li>å¦‚æœç›®æ ‡å±æ€§æ²¡æœ‰é…ç½®å­˜å‚¨æ–¹æ³•ï¼Œå³ set æ–¹æ³•æ˜¯ undefined çš„ï¼Œåˆ™ä¸èƒ½è®¾ç½®ä»–çš„å€¼</li>
<li>ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œå¦‚æœ set() æ–¹æ³•è¿”å› falseï¼Œé‚£ä¹ˆä¹Ÿä¼šæŠ›å‡ºä¸€ä¸ª TypeError å¼‚å¸¸</li>
</ol>
</li>
</ul>
<ol>
<li><code>target</code>ç›®æ ‡å¯¹è±¡</li>
<li><code>property</code>å°†è¢«è®¾ç½®çš„å±æ€§åæˆ– Symbol</li>
<li><code>value</code>æ–°å±æ€§å€¼</li>
<li><code>receiver</code>æœ€åˆè¢«è°ƒç”¨çš„å¯¹è±¡ã€‚é€šå¸¸æ˜¯ proxy æœ¬èº«ï¼Œä½† handler çš„ set æ–¹æ³•ä¹Ÿæœ‰å¯èƒ½åœ¨åŸå‹é“¾ä¸Šï¼Œæˆ–ä»¥å…¶ä»–æ–¹å¼è¢«é—´æ¥åœ°è°ƒç”¨ (å› æ­¤ä¸ä¸€å®šæ˜¯ proxy æœ¬èº«)</li>
</ol>
<h4 id="handlergetprototypeof"><strong>handler.getPrototypeOf()</strong><a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#handlergetprototypeof"></a></h4>
<ul>
<li>åœ¨è¯»å–ä»£ç†å¯¹è±¡çš„åŸå‹æ—¶è§¦å‘è¯¥æ“ä½œ</li>
</ul>
<blockquote>
<p>è¿”å›å€¼å¿…é¡»æ˜¯ä¸€ä¸ªå¯¹è±¡æˆ–è€… null</p>
</blockquote>
<ul>
<li>
<p>æ‹¦æˆª</p>
<ul>
<li><code>Object.getPrototypeOf()</code></li>
<li><code>Reflect.getPrototypeOf()</code></li>
<li><code>\_\_proto\_\_</code></li>
<li><code>Object.prototype.isPrototypeOf()</code></li>
<li><code>instanceof</code></li>
</ul>
</li>
<li>
<p>TypeError:</p>
<ul>
<li><code>getPrototypeOf()</code>æ–¹æ³•è¿”å›çš„ä¸æ˜¯å¯¹è±¡ä¹Ÿä¸æ˜¯ null</li>
<li>ç›®æ ‡å¯¹è±¡æ˜¯ä¸å¯æ‰©å±•çš„ï¼Œä¸”<code>getPrototypeOf()</code>æ–¹æ³•è¿”å›çš„åŸå‹ä¸æ˜¯ç›®æ ‡å¯¹è±¡çš„åŸå‹</li>
</ul>
</li>
</ul>
<pre><code class="hl language-js"><span class="hl-keyword">const</span> obj = {};
<span class="hl-keyword">const</span> proto = {};
<span class="hl-keyword">const</span> handler = {
  <span class="hl-title function_">getPrototypeOf</span>(<span class="hl-params">target</span>) {
    <span class="hl-variable language_">console</span>.<span class="hl-title function_">log</span>(target === obj); <span class="hl-comment">// true</span>
    <span class="hl-variable language_">console</span>.<span class="hl-title function_">log</span>(<span class="hl-variable language_">this</span> === handler); <span class="hl-comment">// true</span>
    <span class="hl-keyword">return</span> proto;
  },
};

<span class="hl-keyword">const</span> p = <span class="hl-keyword">new</span> <span class="hl-title class_">Proxy</span>(obj, handler);
<span class="hl-variable language_">console</span>.<span class="hl-title function_">log</span>(<span class="hl-title class_">Object</span>.<span class="hl-title function_">getPrototypeOf</span>(p) === proto);
</code></pre>
<ol>
<li><code>target</code>:è¢«ä»£ç†çš„ç›®æ ‡å¯¹è±¡</li>
</ol>
<h4 id="handlersetprototypeof"><strong>handler.setPrototypeOf()</strong><a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#handlersetprototypeof"></a></h4>
<ul>
<li>åœ¨è®¾ç½®ä»£ç†å¯¹è±¡çš„åŸå‹æ—¶è§¦å‘è¯¥æ“ä½œ</li>
</ul>
<blockquote>
<p>æˆåŠŸä¿®æ”¹äº†<code>[[Prototype]]</code>,<code>setPrototypeOf</code>æ–¹æ³•è¿”å› trueï¼Œå¦åˆ™è¿”å›
false æˆ–è€…æŠ›å‡ºå¼‚å¸¸</p>
</blockquote>
<ul>
<li>
<p>æ‹¦æˆª</p>
<ul>
<li><code>Object.setPrototypeOf()</code></li>
<li><code>Reflect.setPrototypeOf()</code></li>
</ul>
</li>
<li>
<p>TypeError</p>
<ul>
<li>å¦‚æœ target ä¸å¯æ‰©å±•ï¼ŒåŸå‹å‚æ•°å¿…é¡»ä¸<code>Object.getPrototypeOf(target)</code>çš„å€¼ç›¸åŒ</li>
</ul>
</li>
</ul>
<ol>
<li><code>target</code>ç›®æ ‡å¯¹è±¡</li>
<li><code>prototype</code>å¯¹è±¡æ–°åŸå‹æˆ–ä¸º null</li>
</ol>
<h4 id="handlerisextensible"><strong>handler.isExtensible()</strong><a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#handlerisextensible"></a></h4>
<ul>
<li>åœ¨åˆ¤æ–­ä¸€ä¸ªä»£ç†å¯¹è±¡æ˜¯å¦æ˜¯å¯æ‰©å±•æ—¶è§¦å‘è¯¥æ“ä½œ</li>
</ul>
<blockquote>
<p>å¿…é¡»è¿”å›ä¸€ä¸ª Boolean å€¼æˆ–å¯è½¬æ¢æˆ Boolean çš„å€¼</p>
</blockquote>
<ul>
<li>
<p>æ‹¦æˆª</p>
<ul>
<li><code>Object.isExtensible()</code></li>
<li><code>Reflect.isExtensible()</code></li>
</ul>
</li>
<li>
<p>TypeError:</p>
<ul>
<li>å¿…é¡»è¿”å› true æˆ–è€…ä¸º true çš„å€¼ï¼Œè¿”å› false å’Œä¸º false çš„å€¼éƒ½ä¼šæŠ¥é”™</li>
</ul>
</li>
</ul>
<pre><code class="hl language-js"><span class="hl-keyword">const</span> p = <span class="hl-keyword">new</span> <span class="hl-title class_">Proxy</span>({}, {
  <span class="hl-title function_">isExtensible</span>(<span class="hl-params">target</span>) {
    <span class="hl-variable language_">console</span>.<span class="hl-title function_">log</span>(<span class="hl-string">"called"</span>);
    <span class="hl-keyword">return</span> <span class="hl-literal">true</span>; <span class="hl-comment">//ä¹Ÿå¯ä»¥ return 1;ç­‰è¡¨ç¤ºä¸º true çš„å€¼</span>
  },
});

<span class="hl-variable language_">console</span>.<span class="hl-title function_">log</span>(<span class="hl-title class_">Object</span>.<span class="hl-title function_">isExtensible</span>(p));
</code></pre>
<h4 id="handlerpreventextensions"><strong>handler.preventExtensions()</strong><a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#handlerpreventextensions"></a></h4>
<ul>
<li>åœ¨è®©ä¸€ä¸ªä»£ç†å¯¹è±¡ä¸å¯æ‰©å±•æ—¶è§¦å‘è¯¥æ“ä½œ</li>
</ul>
<blockquote>
<p>è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼</p>
</blockquote>
<ul>
<li>
<p>æ‹¦æˆª</p>
<ul>
<li><code>Object.preventExtensions()</code>:å°†ä¸€ä¸ªå¯¹è±¡å˜ä¸ºä¸å¯æ‰©å±•ï¼Œè¿”å›ä¸€ä¸ªä¸å¯æ‰©å±•çš„å¯¹è±¡</li>
<li><code>Reflect.preventExtensions()</code></li>
</ul>
</li>
<li>
<p>TypeError</p>
<ul>
<li>å¦‚æœç›®æ ‡å¯¹è±¡æ˜¯å¯æ‰©å±•çš„ï¼Œé‚£ä¹ˆåªèƒ½è¿”å› false</li>
</ul>
</li>
</ul>
<pre><code class="hl language-js"><span class="hl-keyword">const</span> p = <span class="hl-keyword">new</span> <span class="hl-title class_">Proxy</span>({}, {
  <span class="hl-title function_">preventExtensions</span>(<span class="hl-params">target</span>) {
    <span class="hl-variable language_">console</span>.<span class="hl-title function_">log</span>(<span class="hl-string">"called"</span>);
    <span class="hl-title class_">Object</span>.<span class="hl-title function_">preventExtensions</span>(target);
    <span class="hl-keyword">return</span> <span class="hl-literal">true</span>;
  },
});

<span class="hl-variable language_">console</span>.<span class="hl-title function_">log</span>(<span class="hl-title class_">Object</span>.<span class="hl-title function_">preventExtensions</span>(p));
</code></pre>
<ol>
<li><code>target</code>:æ‰€è¦æ‹¦æˆªçš„ç›®æ ‡å¯¹è±¡</li>
</ol>
<h4 id="handlergetownpropertydescriptor"><strong>handler.getOwnPropertyDescriptor()</strong><a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#handlergetownpropertydescriptor"></a></h4>
<ul>
<li>åœ¨è·å–ä»£ç†å¯¹è±¡æŸä¸ªå±æ€§çš„å±æ€§æè¿°æ—¶è§¦å‘è¯¥æ“ä½œ</li>
</ul>
<blockquote>
<p>å¿…é¡»è¿”å›ä¸€ä¸ªå¯¹è±¡æˆ– undefined</p>
</blockquote>
<ul>
<li>
<p>æ‹¦æˆª</p>
<ul>
<li><code>Object.getOwnPropertyDescriptor()</code></li>
<li><code>Reflect.getOwnPropertyDescriptor()</code></li>
</ul>
</li>
<li>
<p>TypeError</p>
<ol>
<li>å¿…é¡»è¿”å›ä¸€ä¸ª object æˆ– undefinedï¼Œå¦åˆ™ TypeError</li>
<li>å¦‚æœå±æ€§ä½œä¸ºç›®æ ‡å¯¹è±¡çš„ä¸å¯é…ç½®çš„å±æ€§å­˜åœ¨</li>
<li>å¦‚æœ<strong>å±æ€§ä¸å­˜åœ¨</strong>æˆ–è€…<strong>ä½œä¸ºç›®æ ‡å¯¹è±¡çš„å±æ€§å­˜åœ¨</strong>,å¹¶ä¸”ç›®æ ‡å¯¹è±¡ä¸å¯æ‰©å±•</li>
</ol>
</li>
</ul>
<pre><code class="hl language-js"><span class="hl-keyword">const</span> p = <span class="hl-keyword">new</span> <span class="hl-title class_">Proxy</span>({ <span class="hl-attr">a</span>: <span class="hl-number">20</span> }, {
  <span class="hl-title function_">getOwnPropertyDescriptor</span>(<span class="hl-params">target, prop</span>) {
    <span class="hl-variable language_">console</span>.<span class="hl-title function_">log</span>(<span class="hl-string">"called: "</span> + prop);
    <span class="hl-keyword">return</span> { <span class="hl-attr">configurable</span>: <span class="hl-literal">true</span>, <span class="hl-attr">enumerable</span>: <span class="hl-literal">true</span>, <span class="hl-attr">value</span>: <span class="hl-number">10</span> };
  },
});

<span class="hl-variable language_">console</span>.<span class="hl-title function_">log</span>(<span class="hl-title class_">Object</span>.<span class="hl-title function_">getOwnPropertyDescriptor</span>(p, <span class="hl-string">"a"</span>).<span class="hl-property">value</span>);
<span class="hl-comment">// "called: a"</span>
<span class="hl-comment">//10</span>
</code></pre>
<ol>
<li><code>target</code>ç›®æ ‡å¯¹è±¡</li>
<li><code>prop</code>è¿”å›å±æ€§åç§°çš„æè¿°</li>
</ol>
<h4 id="handlerdefineproperty"><strong>handler.defineProperty()</strong><a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#handlerdefineproperty"></a></h4>
<ul>
<li>åœ¨å®šä¹‰ä»£ç†å¯¹è±¡æŸä¸ªå±æ€§æ—¶çš„å±æ€§æè¿°æ—¶è§¦å‘è¯¥æ“ä½œ</li>
</ul>
<blockquote>
<p>å¿…é¡»ä»¥ä¸€ä¸ª Boolean è¿”å›ï¼Œè¡¨ç¤ºå®šä¹‰è¯¥å±æ€§çš„æ“ä½œæˆåŠŸä¸å¦</p>
</blockquote>
<ul>
<li>
<p>æ‹¦æˆª</p>
<ul>
<li><code>Object.defineProperty()</code></li>
<li><code>Reflect.defineProperty()</code></li>
<li><code>proxy.property='value'</code></li>
</ul>
</li>
<li>
<p>TypeError</p>
<ol>
<li>ç›®æ ‡å¯¹è±¡ä¸å¯æ‰©å±•</li>
<li>ä¸èƒ½æ·»åŠ æˆ–è€…ä¿®æ”¹ä¸€ä¸ªå±æ€§ä¸ºä¸å¯é…ç½®çš„</li>
<li>ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œfalse ä½œä¸º handler.defineProperty æ–¹æ³•çš„è¿”å›å€¼çš„è¯å°†ä¼šæŠ›å‡º
TypeError å¼‚å¸¸</li>
</ol>
</li>
</ul>
<pre><code class="hl language-js"><span class="hl-keyword">const</span> p = <span class="hl-keyword">new</span> <span class="hl-title class_">Proxy</span>({}, {
  <span class="hl-attr">defineProperty</span>: <span class="hl-keyword">function</span> (<span class="hl-params">target, prop, descriptor</span>) {
    <span class="hl-variable language_">console</span>.<span class="hl-title function_">log</span>(<span class="hl-string">"called: "</span> + prop);
    <span class="hl-keyword">return</span> <span class="hl-literal">true</span>;
  },
});

<span class="hl-keyword">const</span> desc = { <span class="hl-attr">configurable</span>: <span class="hl-literal">true</span>, <span class="hl-attr">enumerable</span>: <span class="hl-literal">true</span>, <span class="hl-attr">value</span>: <span class="hl-number">10</span> };
<span class="hl-title class_">Object</span>.<span class="hl-title function_">defineProperty</span>(p, <span class="hl-string">"a"</span>, desc); <span class="hl-comment">// "called: a"</span>
</code></pre>
<ol>
<li><code>target</code>:ç›®æ ‡å¯¹è±¡</li>
<li><code>property</code>å¾…æ£€ç´¢å…¶æè¿°çš„å±æ€§åã€‚</li>
<li><code>descriptor</code>å®šä¹‰æˆ–ä¿®æ”¹çš„å±æ€§çš„å¯èƒ½æ€§</li>
</ol>
<h4 id="handlerdeleteproperty"><strong>handler.deleteProperty()</strong><a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#handlerdeleteproperty"></a></h4>
<ul>
<li>åœ¨åˆ é™¤ä»£ç†å¯¹è±¡çš„æŸä¸ªå±æ€§æ—¶è§¦å‘è¯¥æ“ä½œ</li>
</ul>
<blockquote>
<p>å¿…é¡»è¿”å›ä¸€ä¸ª Boolean ç±»å‹çš„å€¼ï¼Œè¡¨ç¤ºè¯¥å±æ€§æ˜¯å¦è¢«æˆåŠŸåˆ é™¤</p>
</blockquote>
<ul>
<li>
<p>æ‹¦æˆªï¼š</p>
<ul>
<li>åˆ é™¤å±æ€§ï¼š<code>delete proxy.foo</code></li>
<li><code>Reflect.deleteProperty()</code></li>
</ul>
</li>
<li>
<p>TypeError</p>
<ul>
<li>å¦‚æœç›®æ ‡å¯¹è±¡çš„å±æ€§æ˜¯ä¸å¯é…ç½®çš„ï¼Œé‚£ä¹ˆè¯¥å±æ€§ä¸èƒ½è¢«åˆ é™¤</li>
</ul>
</li>
</ul>
<pre><code class="hl language-js"><span class="hl-keyword">const</span> p = <span class="hl-keyword">new</span> <span class="hl-title class_">Proxy</span>({}, {
  <span class="hl-attr">deleteProperty</span>: <span class="hl-keyword">function</span> (<span class="hl-params">target, prop</span>) {
    <span class="hl-variable language_">console</span>.<span class="hl-title function_">log</span>(<span class="hl-string">"called: "</span> + prop);
    <span class="hl-keyword">return</span> <span class="hl-literal">true</span>;
  },
});
<span class="hl-keyword">delete</span> p.<span class="hl-property">a</span>;
</code></pre>
<ol>
<li><code>target</code>ç›®æ ‡å¯¹è±¡</li>
<li><code>property</code>å¾…åˆ é™¤çš„å±æ€§å</li>
</ol>
<h4 id="handlerownkeys"><strong>handler.ownKeys()</strong><a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#handlerownkeys"></a></h4>
<ul>
<li>åœ¨è·å–ä»£ç†å¯¹è±¡çš„æ‰€æœ‰å±æ€§é”®æ—¶è§¦å‘è¯¥æ“ä½œ</li>
</ul>
<blockquote>
<p>ownKeys æ–¹æ³•å¿…é¡»è¿”å›ä¸€ä¸ªå¯æšä¸¾å¯¹è±¡</p>
</blockquote>
<ul>
<li>
<p>æ‹¦æˆª</p>
<ul>
<li><code>Object.getOwnPropertyNames()</code></li>
<li><code>Object.getOwnPropertySymbols()</code></li>
<li><code>Object.keys()</code></li>
<li><code>Reflect.ownKeys()</code></li>
</ul>
</li>
<li>
<p>TypeError</p>
<ol>
<li>ownKeys çš„ç»“æœå¿…é¡»æ˜¯ä¸€ä¸ªæ•°ç»„</li>
<li>æ•°ç»„çš„å…ƒç´ ç±»å‹è¦ä¹ˆæ˜¯ä¸€ä¸ª Stringï¼Œè¦ä¹ˆæ˜¯ä¸€ä¸ª Symbol</li>
<li>ç»“æœåˆ—è¡¨å¿…é¡»åŒ…å«ç›®æ ‡å¯¹è±¡çš„æ‰€æœ‰ä¸å¯é…ç½® (non-configurable),è‡ªæœ‰ (own) å±æ€§çš„ key</li>
<li>å¦‚æœç›®æ ‡å¯¹è±¡ä¸å¯æ‰©å±•ï¼Œé‚£ä¹ˆç»“æœåˆ—è¡¨å¿…é¡»åŒ…å«ç›®æ ‡å¯¹è±¡çš„æ‰€æœ‰è‡ªæœ‰ (own) å±æ€§çš„ keyï¼Œä¸èƒ½æœ‰å…¶å®ƒå€¼</li>
</ol>
</li>
</ul>
<pre><code class="hl language-js"><span class="hl-keyword">const</span> p = <span class="hl-keyword">new</span> <span class="hl-title class_">Proxy</span>({}, {
  <span class="hl-attr">ownKeys</span>: <span class="hl-keyword">function</span> (<span class="hl-params">target</span>) {
    <span class="hl-keyword">return</span> [<span class="hl-string">"a"</span>, <span class="hl-string">"b"</span>, <span class="hl-string">"c"</span>];
  },
});
<span class="hl-variable language_">console</span>.<span class="hl-title function_">log</span>(<span class="hl-title class_">Object</span>.<span class="hl-title function_">getOwnPropertyNames</span>(p));
<span class="hl-comment">// [ 'a', 'b', 'c' ]</span>
</code></pre>
<ol>
<li><code>target</code>:ç›®æ ‡å¯¹è±¡</li>
</ol>
<h4 id="handlerapply"><strong>handler.apply()</strong><a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#handlerapply"></a></h4>
<ul>
<li>åœ¨è°ƒç”¨ä¸€ä¸ªç›®æ ‡å¯¹è±¡ä¸ºå‡½æ•°çš„ä»£ç†å¯¹è±¡æ—¶è§¦å‘è¯¥æ“ä½œ</li>
</ul>
<blockquote>
<p>å¯ä»¥è¿”å›ä»»ä½•å€¼</p>
</blockquote>
<ul>
<li>
<p>æ‹¦æˆª</p>
<ul>
<li><code>proxy(...args)</code></li>
<li><code>Function.prototype.apply()</code> å’Œ <code>Function.prototype.call()</code></li>
<li><code>Reflect.apply()</code></li>
</ul>
</li>
<li>
<p>TypeError</p>
<ul>
<li>å¿…é¡»æ˜¯ä¸€ä¸ªå‡½æ•°</li>
</ul>
</li>
</ul>
<pre><code class="hl language-js"><span class="hl-keyword">const</span> p = <span class="hl-keyword">new</span> <span class="hl-title class_">Proxy</span>(target, {
  <span class="hl-title function_">apply</span>(<span class="hl-params">target, thisArg, argumentsList</span>) {
  },
});
</code></pre>
<ol>
<li><code>thisArg</code>è¢«è°ƒç”¨æ—¶çš„ä¸Šä¸‹æ–‡å¯¹è±¡</li>
<li><code>argumentsList</code>è¢«è°ƒç”¨æ—¶çš„å‚æ•°æ•°ç»„</li>
</ol>
<h4 id="handlerconstruct"><strong>handler.construct()</strong><a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#handlerconstruct"></a></h4>
<ul>
<li>åœ¨ç»™ä¸€ä¸ªç›®æ ‡å¯¹è±¡ä¸ºæ„é€ å‡½æ•°çš„ä»£ç†å¯¹è±¡æ„é€ å®ä¾‹æ—¶è§¦å‘è¯¥æ“ä½œï¼Œç”¨äºåˆå§‹åŒ–ä»£ç†çš„ç›®æ ‡å¯¹è±¡è‡ªèº«å¿…é¡»å…·æœ‰[[æ„é€ ]]å†…éƒ¨æ–¹æ³•</li>
</ul>
<blockquote>
<p>construct æ–¹æ³•å¿…é¡»è¿”å›ä¸€ä¸ªå¯¹è±¡</p>
</blockquote>
<ul>
<li>æ‹¦æˆªä»¥ä¸‹æ“ä½œ
<ul>
<li><strong>new proxy(...args)</strong></li>
<li><strong>Reflect.construct()</strong></li>
</ul>
</li>
</ul>
<pre><code class="hl language-js"><span class="hl-keyword">const</span> p = <span class="hl-keyword">new</span> <span class="hl-title class_">Proxy</span>(target, {
  <span class="hl-title function_">construct</span>(<span class="hl-params">target, argumentsList, newTarget</span>) {
    <span class="hl-keyword">return</span> {};
  },
});
</code></pre>
<ol>
<li><code>target</code>:ç›®æ ‡å¯¹è±¡</li>
<li><code>argumentsList</code>:constructor çš„å‚æ•°åˆ—è¡¨</li>
<li><code>newTarget</code>:æœ€åˆè¢«è°ƒç”¨çš„æ„é€ å‡½æ•°ï¼Œå°±ä¸Šé¢çš„ä¾‹å­è€Œè¨€æ˜¯ p</li>
</ol>
        </article></main><script src="https://giscus.app/client.js"
        data-repo="fwqaaq/fwqaaq.github.io"
        data-repo-id="R_kgDOHCFK2A"
        data-category="Show and tell"
        data-category-id="DIC_kwDOHCFK2M4CYOLh"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="1"
        data-input-position="bottom"
        data-theme="preferred_color_scheme"
        data-lang="zh-CN"
        crossorigin="anonymous"
        async></script>