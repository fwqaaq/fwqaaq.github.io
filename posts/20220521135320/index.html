<!DOCTYPE html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="theme-color" content="rgb(46, 44, 79)">
  <meta name="description" content="ä½¿ç”¨ Javascript æ¥æ“ä½œ Github Action">
  <meta name="keywords" content="Git, GitHub">
  <title>
    GitHub Action MetaData
  </title>
  <link rel="stylesheet" href="/public/css/index.css">
  <link rel="stylesheet" href="/public/css/markdown.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
  <script src="/public/JavaScript/index.js"></script>
</head><header class="blog-header">
  <a href="https://github.com/fwqaaq" target="_blank">
    <img src="https://avatars.githubusercontent.com/u/82551626?v=4" loading="lazy" alt="me" srcset="">
  </a>
  <nav class="header-nav">
    <a class="decoration-line" href="/"><i class="fa-solid fa-house-chimney fa-xs"></i>
      <span class="disappear">Home</span>
    </a>
    <a class="decoration-line" href="/./about/index.html"><i class="fa-solid fa-address-card fa-xs"></i>
      <span class="disappear">About</span></a>
    <a class="decoration-line" href="/./archive/index.html"><i class="fa-solid fa-box-archive fa-xs"></i> <span
        class="disappear">Archive</span></a>
    <a class="decoration-line" href="/./tags/index.html"><i class="fa-solid fa-tag fa-xs"></i> <span
        class="disappear">Tag</span></a>
    <div class="toy"><i class="fa-solid fa-gamepad fa-xs"></i> <span class="disappear">Toy</span>
      <nav class="toy-nav disappear">
        <a class="decoration-line" href="/public/resume/">æˆ‘çš„ç®€å†</a>
        <a class="decoration-line" href="/public/write-css/index.html">å­¦ä¹  UI</a>
      </nav>
    </div>
    <a class="decoration-line" href="/feed.xml"><i class="fa-solid fa-rss fa-xs"></i> <span
        class="disappear">RSS</span></a>
    <a class="decoration-line model" href="#" class="model"><i class="fa-solid fa-sun fa-xs"></i></a>
  </nav>
</header><main class="blog-main">
          <article class="blog-article">
            <h1>GitHub Action MetaData</h1>
            <hr>
            <blockquote>
<p>åˆ›å»º action å’Œä½¿ç”¨ workflows æ˜¯ä¸¤ä¸ªä¸åŒçš„æ“ä½œ</p>
</blockquote>
<ol>
<li>ä½¿ç”¨ <a href="https://docs.github.com/cn/actions/using-workflows/about-workflows">workflows</a> æ˜¯ä¸€ä¸ªè‡ªåŠ¨åŒ–çš„è¿‡ç¨‹
<ul>
<li>ç”± <code>.github/workflows</code> ä¸‹çš„ <code>yaml</code> æ–‡ä»¶å®šä¹‰ï¼Œå¯ä»¥æ˜¯äº‹ä»¶ï¼Œäº‹ä»¶æˆ–è€…æ‰‹åŠ¨è§¦å‘</li>
</ul>
</li>
<li>åˆ›å»º <a href="https://docs.github.com/cn/actions/creating-actions/about-custom-actions">action</a> å¯ä»¥åˆ›å»ºè‡ªå·±çš„æ“ä½œæˆ–è€…ä½¿ç”¨å’Œè‡ªå®šä¹‰ github ç¤¾åŒºåˆ†äº«çš„æ“ä½œ
<ul>
<li>åœ¨æ“ä½œä¸»è¦å…ƒæ•°æ®æ–‡ä»¶æŒ‰æ¥å®šä¹‰æ“ä½œçš„è¾“å…¥ï¼Œè¾“å‡ºå’Œä¸»è¦è¿›å…¥ç‚¹ã€‚å…ƒæ•°æ®çš„æ–‡ä»¶åå¿…é¡»è¦ <code>action.yml</code></li>
</ul>
</li>
</ol>
<h2 id="javascript-æ“ä½œ"><a href="https://docs.github.com/cn/actions/creating-actions/creating-a-javascript-action">JavaScript æ“ä½œ</a><a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#javascript-æ“ä½œ"></a></h2>
<ul>
<li>è¿™é‡Œå°è¯•æ¼”ç¤ºä¸€ä¸ªä½¿ç”¨ actions å…ƒæ•°æ®å»ç¼–å†™ä¸€ä¸ª Issue è‡ªåŠ¨æäº¤</li>
</ul>
<blockquote>
<p><a href="https://docs.github.com/cn/actions/creating-actions/metadata-syntax-for-github-actions">GitHub Actions çš„å…ƒæ•°æ®è¯­æ³•</a></p>
</blockquote>
<ul>
<li>åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª <code>action.yml</code> æ–‡ä»¶ï¼Œå¹¶ä¸”æ–‡ä»¶åç§°åªèƒ½æ˜¯è¿™ä¸ª</li>
</ul>
<pre><code class="hl language-yaml"><span class="hl-attr">name:</span> <span class="hl-string">'test one create issues'</span>
<span class="hl-attr">description:</span> <span class="hl-string">'test create issues'</span>
<span class="hl-attr">inputs:</span>
  <span class="hl-attr">token:</span>
    <span class="hl-attr">description:</span> <span class="hl-string">'ACTION_ACCESS'</span>
    <span class="hl-attr">required:</span> <span class="hl-literal">true</span>
    <span class="hl-attr">default:</span> <span class="hl-string">${{github.token}}</span>
  <span class="hl-attr">repoURL:</span>
    <span class="hl-attr">description:</span> <span class="hl-string">'repo'</span>
    <span class="hl-attr">default:</span> <span class="hl-string">${{github.repositoryUrl}}</span>
  <span class="hl-attr">path:</span>
    <span class="hl-attr">description:</span> <span class="hl-string">'path'</span>
    <span class="hl-attr">default:</span> <span class="hl-string">${{github.action_path}}</span>
<span class="hl-attr">runs:</span>
  <span class="hl-attr">using:</span> <span class="hl-string">'node16'</span>
  <span class="hl-attr">main:</span> <span class="hl-string">'index.mjs'</span>
</code></pre>
<ul>
<li><code>inputs</code> æ˜¯æŒ‡å®šä»å·¥ä½œæµï¼ˆworkflowsï¼‰ä¸­è·å–å¯¹åº”çš„è¾“å…¥å­—æ®µï¼Œ<code>token</code> æ˜¯å·¥ä½œæµï¼ˆworkflowsï¼‰ä¸­çš„åç§°</li>
<li><code>runs</code>ï¼šæŒ‡å®šçš„æ“ä½œï¼Œè¿™é‡Œå¿…é¡»æŒ‡å®šæ˜¯ JavaScript æ“ä½œï¼Œå¤åˆæ“ä½œè¿˜æ˜¯ Docker å®¹å™¨æ“ä½œä»¥åŠæ“ä½œçš„æ‰§è¡Œæ–¹å¼
<ul>
<li>
<p><code>using</code>ï¼š<strong>å¿…è¦</strong>ã€‚æŒ‡å®š <code>main</code> ä¸­ä»£ç çš„æ‰§è¡Œç¯å¢ƒ</p>
</li>
<li>
<p><code>main</code>ï¼š<strong>å¿…è¦</strong>ã€‚åŒ…å«æ“ä½œçš„æ–‡ä»¶</p>
</li>
<li>
<p><code>pre</code>ï¼šå…è®¸ä½ åœ¨ <code>main</code> æ“ä½œå¼€å§‹ä¹‹å‰ï¼Œåœ¨ä½œä¸šå¼€å§‹æ—¶è¿è¡Œè„šæœ¬</p>
</li>
<li>
<p><code>pre-if</code>ï¼šå…è®¸å®šä¹‰ <code>pre</code> æ“ä½œæ‰§è¡Œçš„æ¡ä»¶ã€‚pre æ“ä½œåªä¼šåœ¨æ»¡è¶³ <code>pre-if</code> ä¸­çš„æ¡ä»¶è¿è¡Œã€‚å¦‚æœæœªè®¾ç½®ï¼Œåˆ™ <code>pre-if</code> é»˜è®¤ä½¿ç”¨ <code>always()</code></p>
<pre><code class="hl language-yml"><span class="hl-attr">pre:</span> <span class="hl-string">'cleanup.js'</span>
<span class="hl-attr">pre-if:</span> <span class="hl-string">runner.os</span> <span class="hl-string">==</span> <span class="hl-string">'linux'</span>
</code></pre>
</li>
<li>
<p><code>post</code>ï¼šå…è®¸ä½ åœ¨ <code>main</code> æ“ä½œå®Œæˆåï¼Œåœ¨ä½œä¸šç»“æŸæ—¶è¿è¡Œè„šæœ¬</p>
<ul>
<li>ä¾‹å¦‚ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>post</code> ç»ˆæ­¢æŸäº›è¿›ç¨‹æˆ–åˆ é™¤ä¸éœ€è¦çš„æ–‡ä»¶</li>
</ul>
</li>
<li>
<p><code>post-if</code>ï¼šå…è®¸å®šä¹‰çš„ <code>post</code> æ“ä½œæ‰§è¡Œçš„æ¡ä»¶ï¼Œå’Œ <code>pre-if</code> ç±»ä¼¼</p>
<pre><code class="hl language-yml"><span class="hl-attr">runs:</span>
  <span class="hl-attr">using:</span> <span class="hl-string">'node16'</span>
  <span class="hl-attr">main:</span> <span class="hl-string">'index.js'</span>
  <span class="hl-attr">post:</span> <span class="hl-string">'cleanup.js'</span>
  <span class="hl-attr">post:</span> <span class="hl-string">'cleanup.js'</span>
  <span class="hl-attr">post-if:</span> <span class="hl-string">runner.os</span> <span class="hl-string">==</span> <span class="hl-string">'linux'</span>
</code></pre>
</li>
<li>
<p><code>steps</code>ï¼šæ“ä½œä¸­çš„æ­¥éª¤ã€‚è¿™é‡Œæ˜¯ç¬¦åˆæ“ä½œï¼Œusing å¿…é¡»æŒ‡å®š--><code>using:"composite"</code></p>
<ul>
<li><code>shell</code>ï¼šå¦‚æœæœ‰ run æ“ä½œï¼Œå¿…é¡»æŒ‡å®š <code>shell</code></li>
</ul>
<pre><code class="hl language-js"><span class="hl-attr">runs</span>:
  <span class="hl-attr">using</span>: <span class="hl-string">"composite"</span>
  <span class="hl-attr">steps</span>:
    - <span class="hl-attr">run</span>: ${{ github.<span class="hl-property">action_path</span> }}/test/script.<span class="hl-property">sh</span>
      <span class="hl-attr">shell</span>: bash
</code></pre>
<p>...</p>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>ç¼–å†™ index.js æ–‡ä»¶</p>
</blockquote>
<ul>
<li>
<p>ä¸‹è½½ octokit:<code>pnpm add octokit</code>ï¼Œè¿™é‡Œéœ€è¦ä½¿ç”¨è¿™ä¸ªåŒ…å¯¹ github æš´éœ²çš„æ¥å£è¿›è¡Œæ“ä½œ</p>
</li>
<li>
<p>ä¸‹è½½ <code>@actions/core</code>:<code>pnpm add @actions/core</code>ï¼Œè¯¥åŒ…æä¾›ä¸€ä¸ªæ¥å£ï¼Œç”¨äºå·¥ä½œæµç¨‹å‘½ä»¤ï¼Œè¾“å…¥å’Œè¾“å‡ºå˜é‡ï¼Œé€€å‡ºçŠ¶æ€ä»¥åŠè°ƒè¯•</p>
<pre><code class="hl language-js"><span class="hl-keyword">import</span> { <span class="hl-title class_">Octokit</span> } <span class="hl-keyword">from</span> <span class="hl-string">"octokit"</span>;
<span class="hl-keyword">import</span> { getInput } <span class="hl-keyword">from</span> <span class="hl-string">"@actions/core"</span>;
<span class="hl-keyword">import</span> dayjs <span class="hl-keyword">from</span> <span class="hl-string">"dayjs"</span>;
<span class="hl-keyword">const</span> token = <span class="hl-title function_">getInput</span>(<span class="hl-string">"token"</span>);
<span class="hl-keyword">const</span> octokit = <span class="hl-keyword">new</span> <span class="hl-title class_">Octokit</span>({
  <span class="hl-attr">auth</span>: token,
});
<span class="hl-keyword">await</span> octokit.<span class="hl-property">rest</span>.<span class="hl-property">issues</span>.<span class="hl-title function_">create</span>({
  <span class="hl-attr">owner</span>: <span class="hl-string">"fwqaaq"</span>,
  <span class="hl-attr">repo</span>: <span class="hl-string">"demo"</span>,
  <span class="hl-attr">title</span>: <span class="hl-title function_">getTitle</span>(),
  <span class="hl-attr">body</span>: <span class="hl-title function_">getBody</span>(),
});

<span class="hl-keyword">function</span> <span class="hl-title function_">getTitle</span>(<span class="hl-params"></span>) {
  <span class="hl-keyword">return</span> <span class="hl-title function_">dayjs</span>().<span class="hl-title function_">format</span>(<span class="hl-string">"YYYY-MM-DD"</span>);
}

<span class="hl-keyword">function</span> <span class="hl-title function_">getBody</span>(<span class="hl-params"></span>) {
  <span class="hl-keyword">return</span> <span class="hl-string">"* test a new task"</span>;
}
</code></pre>
</li>
<li>
<p>è¿™é‡Œçš„ <code>auth:token</code>ï¼Œæ˜¯è·å–çš„ <code>workflows</code> ä¸­ <code>with</code> å…³é”®å­—è®¾ç½®çš„è¾“å…¥å‚æ•°</p>
</li>
</ul>
<blockquote>
<p>ç¼–å†™å·¥ä½œæµ <code>workflows</code></p>
</blockquote>
<pre><code class="hl language-js"><span class="hl-attr">on</span>: [push]

<span class="hl-attr">jobs</span>:
  <span class="hl-attr">test_one_issues</span>:
    runs-<span class="hl-attr">on</span>: ubuntu-latest
    <span class="hl-attr">name</span>: create issues action
    <span class="hl-attr">steps</span>:
      - <span class="hl-attr">name</span>: <span class="hl-title class_">Checkout</span>
        <span class="hl-attr">uses</span>: actions/checkout@v3
      - <span class="hl-attr">name</span>: node
        <span class="hl-attr">uses</span>: actions/setup-node@v3<span class="hl-number">.0</span><span class="hl-number">.0</span>
        <span class="hl-attr">with</span>:
          node-<span class="hl-attr">version</span>: <span class="hl-string">"16.x"</span>
      - <span class="hl-attr">name</span>: install
        <span class="hl-attr">run</span>: npm install
      - <span class="hl-attr">name</span>: create issues
        <span class="hl-attr">uses</span>: ./
        <span class="hl-attr">with</span>:
          <span class="hl-attr">token</span>: ${{secrets.<span class="hl-property">ACTION_ACCESS</span>}}
</code></pre>
<ul>
<li>æœ€åä¸€ä¸ª <code>create issues</code> ä¸­çš„ <code>uses:./</code> å°±æ˜¯æŒ‡å®šæ ¹è·¯å¾„ä¸‹è‡ªå·±çš„ action å…ƒæ•°æ® <code>action.yml</code></li>
<li><code>with</code> å°±æ˜¯ä¼ ç»™ <code>action.yml</code> çš„é”®å€¼å¯¹ã€‚å¹¶ä¸”åœ¨ <code>index.js</code> ä¸­ä½¿ç”¨äº† <code>@action/core</code> ä¸­çš„ <code>getInput</code> è·å–</li>
</ul>
<blockquote>
<p>å¦‚æœåªæƒ³æ‰“åŒ… dist æ–‡ä»¶åˆ°ä»“åº“ï¼Œå¯ä»¥ä½¿ç”¨ <code>@vercel/ncc</code> è¿™ä¸ªåŒ…ï¼Œè¿™ä¸ªåŒ…åªä¼šæŠŠå¼•ç”¨çš„æ¨¡å—åŠ è½½åˆ° dist åŒ…ä¸­</p>
</blockquote>
<ul>
<li>ä¸‹è½½ ncc åŒ…ï¼š<code>pnpm add @vercel/ncc</code></li>
<li>ç„¶åæ·»åŠ è„šæœ¬ï¼š<code>"build": "ncc build index.mjs --license licenses.txt"</code></li>
<li>è¿è¡Œä¹‹åå°±å¯ä»¥ä½¿ç”¨ dist åŒ…æ¯å¤©æ›´æ–° issue</li>
</ul>
        </article></main><script src="https://giscus.app/client.js"
        data-repo="fwqaaq/fwqaaq.github.io"
        data-repo-id="R_kgDOHCFK2A"
        data-category="Show and tell"
        data-category-id="DIC_kwDOHCFK2M4CYOLh"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="1"
        data-input-position="bottom"
        data-theme="preferred_color_scheme"
        data-lang="zh-CN"
        crossorigin="anonymous"
        async></script>