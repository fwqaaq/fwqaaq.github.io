<!DOCTYPE html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="theme-color" content="rgb(46, 44, 79)">
  <meta name="description" content="ä½¿ç”¨ puppeteer åšä¸€ä¸ªçˆ¬è™«">
  <meta name="keywords" content="JavaScript, Config">
  <title>
    puppeteer
  </title>
  <link rel="stylesheet" href="/public/css/index.css">
  <link rel="stylesheet" href="/public/css/markdown.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
  <script src="/public/JavaScript/index.js"></script>
</head><header class="blog-header">
  <a href="https://github.com/fwqaaq" target="_blank">
    <img src="https://avatars.githubusercontent.com/u/82551626?v=4" loading="lazy" alt="me" srcset="">
  </a>
  <nav class="header-nav">
    <a class="decoration-line" href="/"><i class="fa-solid fa-house-chimney fa-xs"></i>
      <span class="disappear">Home</span>
    </a>
    <a class="decoration-line" href="/./about/index.html"><i class="fa-solid fa-address-card fa-xs"></i>
      <span class="disappear">About</span></a>
    <a class="decoration-line" href="/./archive/index.html"><i class="fa-solid fa-box-archive fa-xs"></i> <span
        class="disappear">Archive</span></a>
    <a class="decoration-line" href="/./tags/index.html"><i class="fa-solid fa-tag fa-xs"></i> <span
        class="disappear">Tag</span></a>
    <div class="toy"><i class="fa-solid fa-gamepad fa-xs"></i> <span class="disappear">Toy</span>
      <nav class="toy-nav disappear">
        <a class="decoration-line" href="/public/resume/">æˆ‘çš„ç®€å†</a>
        <a class="decoration-line" href="/public/write-css/index.html">å­¦ä¹  UI</a>
      </nav>
    </div>
    <a class="decoration-line" href="/feed.xml"><i class="fa-solid fa-rss fa-xs"></i> <span
        class="disappear">RSS</span></a>
    <a class="decoration-line model" href="#" class="model"><i class="fa-solid fa-sun fa-xs"></i></a>
  </nav>
</header><main class="blog-main">
          <article class="blog-article">
            <h1>puppeteer</h1>
            <hr>
            <h2 id="çˆ¬å–é¡µé¢æˆ–è€…æ¥å£æ•°æ®">çˆ¬å–é¡µé¢æˆ–è€…æ¥å£æ•°æ®<a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#çˆ¬å–é¡µé¢æˆ–è€…æ¥å£æ•°æ®"></a></h2>
<blockquote>
<p>é¡µé¢å¾—æ˜¯ ssrï¼ˆæœåŠ¡å™¨æ¸²æŸ“ï¼‰<code>post</code>,<code>get</code> ç­‰è¯·æ±‚éƒ½å¯ä»¥</p>
<p>ä½¿ç”¨ <code>axios</code> åº“</p>
</blockquote>
<pre><code class="hl language-js"><span class="hl-keyword">const</span> axios = <span class="hl-built_in">require</span>(<span class="hl-string">"axios"</span>);
<span class="hl-keyword">const</span> fs = <span class="hl-built_in">require</span>(<span class="hl-string">"fs/promises"</span>);
<span class="hl-keyword">const</span> url = <span class="hl-string">"https://music.163.com/#/song?id=30431367"</span>;
axios.<span class="hl-title function_">get</span>(url, <span class="hl-function">(<span class="hl-params">error, response, body</span>) =></span> {
  fs.<span class="hl-title function_">writeFile</span>(<span class="hl-string">"./bilibili.html"</span>, body);
});
</code></pre>
<h2 id="puppeteer-ç®€ä»‹">Puppeteer ç®€ä»‹<a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#puppeteer-ç®€ä»‹"></a></h2>
<blockquote>
<p><code>Puppeteer</code> æ˜¯ä¸€ä¸ª <code>Node</code> åº“ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªé«˜çº§ API æ¥é€šè¿‡ DevTools åè®®æ§åˆ¶ <code>Chrome</code> æˆ– <code>Chromium</code>.<code>Puppeteer</code> é»˜è®¤æ— å¤´è¿è¡Œï¼Œä½†å¯ä»¥é…ç½®ä¸ºè¿è¡Œå®Œæ•´ (éæ— å¤´) <code>Chrome</code> æˆ– <code>Chromium</code>ã€‚</p>
</blockquote>
<h3 id="ä½¿ç”¨ç‰¹ç‚¹">ä½¿ç”¨ç‰¹ç‚¹<a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#ä½¿ç”¨ç‰¹ç‚¹"></a></h3>
<ol>
<li>ç”Ÿæˆé¡µé¢çš„å±å¹•æˆªå›¾å’Œ PDF</li>
<li>æŠ“å– SPA(å•é¡µåº”ç”¨ç¨‹åº) å¹¶ç”Ÿæˆé¢„æ¸²æŸ“å†…å®¹ (å³<code>SSR</code>(æœåŠ¡å™¨ç«¯æ¸²æŸ“))</li>
<li>è‡ªåŠ¨åŒ–è¡¨å•æäº¤ï¼ŒUI æµ‹è¯•ï¼Œé”®ç›˜è¾“å…¥ç­‰</li>
<li>åˆ›å»ºæœ€æ–°çš„è‡ªåŠ¨åŒ–æµ‹è¯•ç¯å¢ƒä½¿ç”¨æœ€æ–°çš„ JavaScript å’Œæµè§ˆå™¨åŠŸèƒ½ï¼Œç›´æ¥åœ¨æœ€æ–°ç‰ˆæœ¬çš„ Chrome ä¸­è¿è¡Œæ‚¨çš„æµ‹è¯•</li>
<li>æ•è·ç«™ç‚¹çš„æ—¶é—´çº¿è·Ÿè¸ªä»¥å¸®åŠ©è¯Šæ–­æ€§èƒ½é—®é¢˜</li>
<li>æµ‹è¯• Chrome æ‰©å±•</li>
</ol>
<h3 id="puppeteer-core">puppeteer-core<a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#puppeteer-core"></a></h3>
<ul>
<li>å½“æ‚¨å®‰è£…<code>Puppeteer</code>æ—¶ï¼Œå®ƒä¼šä¸‹è½½ä¿è¯ä¸ API ä¸€èµ·ä½¿ç”¨çš„æœ€æ–°ç‰ˆæœ¬çš„ <code>Chromium</code></li>
<li><code>puppeteer-core</code>åŒ…ï¼Œä¸€ä¸ªé»˜è®¤ä¸ä¸‹è½½ä»»ä½•æµè§ˆå™¨çš„<code>Puppeteer</code>ç‰ˆæœ¬</li>
</ul>
<blockquote>
<p>ä½¿ç”¨<code>puppeteer-core</code>éœ€è¦ä¼ <code>google</code>æ‰€åœ¨çš„æµè§ˆå™¨çš„ç»å¯¹åœ°å€ï¼Œå±æ€§<code>executablePath</code></p>
</blockquote>
<ul>
<li>ä½¿ç”¨<strong>ç»å¯¹åœ°å€</strong>æˆ–è€…ä½¿ç”¨æ’ä»¶åº“<code>carlo</code></li>
</ul>
<pre><code class="hl language-js"><span class="hl-keyword">const</span> puppeteer = <span class="hl-built_in">require</span>(<span class="hl-string">"puppeteer-core"</span>);
<span class="hl-keyword">const</span> findChrome = <span class="hl-built_in">require</span>(<span class="hl-string">"./node_modules/carlo/lib/find_chrome"</span>);
(<span class="hl-keyword">async</span> <span class="hl-keyword">function</span> (<span class="hl-params"></span>) {
  <span class="hl-keyword">const</span> findChromePath = <span class="hl-keyword">await</span> <span class="hl-title function_">findChrome</span>({});
  <span class="hl-keyword">const</span> executablePath = <span class="hl-keyword">await</span> findChromePath.<span class="hl-property">executablePath</span>;
  <span class="hl-keyword">const</span> browser = <span class="hl-keyword">await</span> puppeteer.<span class="hl-title function_">launch</span>({
    <span class="hl-comment">//executablePath: "C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe",</span>
    executablePath,
    <span class="hl-attr">headless</span>: <span class="hl-literal">false</span>,
    <span class="hl-attr">defaultViewport</span>: <span class="hl-literal">null</span>,
    <span class="hl-attr">args</span>: [<span class="hl-string">"--start-fullscreen"</span>],
    <span class="hl-attr">ignoreHTTPSErrors</span>: <span class="hl-literal">true</span>,
  });
  <span class="hl-keyword">const</span> page = <span class="hl-keyword">await</span> browser.<span class="hl-title function_">newPage</span>();
  <span class="hl-keyword">await</span> page.<span class="hl-title function_">goto</span>(<span class="hl-string">"https://www.bilibili.com/"</span>);
  <span class="hl-keyword">await</span> page.<span class="hl-title function_">screenshot</span>({
    <span class="hl-attr">path</span>: <span class="hl-string">"./bilibili.png"</span>,
    <span class="hl-attr">type</span>: <span class="hl-string">"png"</span>,
  });
  browser.<span class="hl-title function_">close</span>();
})();
</code></pre>
<h3 id="puppeteer-æ¦‚è¿°">puppeteer æ¦‚è¿°<a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#puppeteer-æ¦‚è¿°"></a></h3>
<blockquote>
<p>Puppeteer API æ˜¯åˆ†å±‚çš„ï¼Œå¹¶åæ˜ äº†æµè§ˆå™¨ç»“æ„</p>
</blockquote>
<ol>
<li><code>Puppeteer</code>ï¼šä½¿ç”¨ DevTools åè®®ä¸æµè§ˆå™¨é€šä¿¡ã€‚</li>
<li><code>Browser</code> å®ä¾‹å¯ä»¥æ‹¥æœ‰å¤šä¸ªæµè§ˆå™¨ä¸Šä¸‹æ–‡ã€‚</li>
<li><code>BrowserContext</code> å®ä¾‹å®šä¹‰äº†ä¸€ä¸ªæµè§ˆä¼šè¯å¹¶ä¸”å¯ä»¥æ‹¥æœ‰å¤šä¸ªé¡µé¢ã€‚</li>
<li><code>Page</code> è‡³å°‘æœ‰ä¸€ä¸ªæ¡†æ¶ä¸»æ¡†æ¶ã€‚å¯èƒ½è¿˜æœ‰å…¶ä»–æ¡†æ¶ç”± iframe æˆ–æ¡†æ¶æ ‡ç­¾åˆ›å»ºã€‚</li>
<li><code>Frame</code> è‡³å°‘æœ‰ä¸€ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡â€”â€”é»˜è®¤æ‰§è¡Œä¸Šä¸‹æ–‡â€”â€”æ¡†æ¶çš„ JavaScript åœ¨è¿™é‡Œæ‰§è¡Œ.Frame å¯èƒ½å…·æœ‰ä¸æ‰©å±•ç›¸å…³è”çš„é™„åŠ æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚</li>
<li><code>Worker</code> æœ‰ä¸€ä¸ªå•ä¸€çš„æ‰§è¡Œä¸Šä¸‹æ–‡å¹¶ä¿ƒè¿›ä¸ WebWorkers çš„äº¤äº’ã€‚</li>
</ol>
<blockquote>
<p>å‚è€ƒ:<a href="https://github.com/puppeteer/puppeteer/blob/main/docs/api.md#puppeteer-vs-puppeteer-core">https://github.com/puppeteer/puppeteer/blob/main/docs/api.md#puppeteer-vs-puppeteer-core</a></p>
</blockquote>
<h2 id="å…³äºä½¿ç”¨">å…³äºä½¿ç”¨<a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#å…³äºä½¿ç”¨"></a></h2>
<h3 id="ä½¿ç”¨-connect-è¿æ¥">ä½¿ç”¨ connect è¿æ¥<a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#ä½¿ç”¨-connect-è¿æ¥"></a></h3>
<blockquote>
<p>å¯åŠ¨å¸¦æœ‰æ‰€æœ‰æ’ä»¶å’Œè´¦å·çš„ chrome</p>
</blockquote>
<p>æŸ¥çœ‹ cdp åè®®ï¼Œåœ¨ settings > Experiments > Protocol Monitor æ‰“å¼€</p>
<ol>
<li>
<p>é¦–å…ˆæ‰“å¼€ chrome çš„å¿«æ·æ–¹å¼ï¼Œåœ¨ç›®æ ‡åè¾“å…¥<code>--remote-debugging-port=9222</code>.å¤§æ¦‚æ˜¯ä¸‹é¢è¿™æ ·</p>
<blockquote>
<p><code>"C:\Program Files\Google\Chrome\Application\chrome.exe" --remote-debugging-port=9222</code>
åˆ‡è®° exe åé¢ä¸€å®šè¦æœ‰ç©ºæ ¼ï¼Œè¿™ç§æ–¹å¼ä¹Ÿæœ‰ç¼ºç‚¹ï¼Œå¯èƒ½ä¼šæœ‰è¿æ¥ä¸ä¸Šçš„æ—¶å€™
ä»–çš„ url åœ¨ï¼š<code>http://localhost:9222/json/version</code>,å¯èƒ½æ‰“å¼€æµè§ˆå™¨ä¸¤ä¸‰æ¬¡æ‰ä¼šæœ‰è¿æ¥</p>
</blockquote>
<pre><code class="hl language-js"><span class="hl-keyword">const</span> puppeteer = <span class="hl-built_in">require</span>(<span class="hl-string">'puppeteer-core'</span>);
<span class="hl-keyword">const</span> axios = <span class="hl-built_in">require</span>(<span class="hl-string">"axios"</span>);
(<span class="hl-keyword">async</span> () => {
  <span class="hl-keyword">const</span> response = <span class="hl-keyword">await</span> axios.<span class="hl-title function_">get</span>(<span class="hl-string">"http://localhost:9222/json/version"</span>)
  <span class="hl-keyword">const</span> { webSocketDebuggerUrl } = response.<span class="hl-property">data</span>
  <span class="hl-keyword">const</span> browser = <span class="hl-keyword">await</span> puppeteer.<span class="hl-title function_">connect</span>({
    <span class="hl-attr">browserWSEndpoint</span>: webSocketDebuggerUrl,
    <span class="hl-attr">defaultViewport</span>: <span class="hl-literal">null</span>
  });
  <span class="hl-keyword">const</span> page = <span class="hl-keyword">await</span> browser.<span class="hl-title function_">newPage</span>()
  ...
  <span class="hl-keyword">await</span> browser.<span class="hl-title function_">disconnect</span>();
})();
</code></pre>
</li>
<li>
<p>ä¸€èˆ¬æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ cli å‘½ä»¤ç›´æ¥æ‰§è¡Œï¼Œä¾‹å¦‚åœ¨æŸ linux å‘è¡Œç‰ˆä¸­</p>
<pre><code class="hl language-bash"><span class="hl-comment"># --user-data-dir ä½ ä¹Ÿå¯ä»¥æŒ‡å®šå®ƒæ•°æ®çš„ç›®å½•</span>
./chrome --remote-debugging-port=9929
</code></pre>
<ul>
<li>æˆ‘ä»¬å¯ä»¥è‡ªå·±å†™ä¸€ä¸ªè‡ªåŠ¨å¯åŠ¨è„šæœ¬</li>
</ul>
<pre><code class="hl language-bash"><span class="hl-meta">#!/usr/bin/env sh</span>
<span class="hl-built_in">cd</span> /opt/google/chrome/ &#x26;&#x26; ./chrome --add-debugging-port=<span class="hl-variable">$1</span>
</code></pre>
<ul>
<li>ä¸€äº›æƒé™æ“ä½œ</li>
</ul>
<pre><code class="hl language-bash"><span class="hl-built_in">chmod</span> +x ./chrome.sh
<span class="hl-built_in">ln</span> ./chrome.sh /bin/chrome
</code></pre>
<ul>
<li>ä½¿ç”¨ <code>chrome 9929</code></li>
</ul>
</li>
</ol>
        </article></main><script src="https://giscus.app/client.js"
        data-repo="fwqaaq/fwqaaq.github.io"
        data-repo-id="R_kgDOHCFK2A"
        data-category="Show and tell"
        data-category-id="DIC_kwDOHCFK2M4CYOLh"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="1"
        data-input-position="bottom"
        data-theme="preferred_color_scheme"
        data-lang="zh-CN"
        crossorigin="anonymous"
        async></script>