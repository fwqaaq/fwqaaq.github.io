<!DOCTYPE html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="theme-color" content="rgb(46, 44, 79)">
  <meta name="description" content="Docker çš„ç®€å•åº”ç”¨">
  <meta name="keywords" content="Docker, Config">
  <title>
    Docker
  </title>
  <link rel="stylesheet" href="/public/css/index.css">
  <link rel="stylesheet" href="/public/css/markdown.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
  <script src="/public/JavaScript/index.js"></script>
</head><header class="blog-header">
  <a href="https://github.com/fwqaaq" target="_blank">
    <img src="https://avatars.githubusercontent.com/u/82551626?v=4" loading="lazy" alt="me" srcset="">
  </a>
  <nav class="header-nav">
    <a class="decoration-line" href="/"><i class="fa-solid fa-house-chimney fa-xs"></i>
      <span class="disappear">Home</span>
    </a>
    <a class="decoration-line" href="/./about/index.html"><i class="fa-solid fa-address-card fa-xs"></i>
      <span class="disappear">About</span></a>
    <a class="decoration-line" href="/./archive/index.html"><i class="fa-solid fa-box-archive fa-xs"></i> <span
        class="disappear">Archive</span></a>
    <a class="decoration-line" href="/./tags/index.html"><i class="fa-solid fa-tag fa-xs"></i> <span
        class="disappear">Tag</span></a>
    <div class="toy"><i class="fa-solid fa-gamepad fa-xs"></i> <span class="disappear">Toy</span>
      <nav class="toy-nav disappear">
        <a class="decoration-line" href="/public/resume/">æˆ‘çš„ç®€å†</a>
        <a class="decoration-line" href="/public/write-css/index.html">å­¦ä¹  UI</a>
      </nav>
    </div>
    <a class="decoration-line" href="/feed.xml"><i class="fa-solid fa-rss fa-xs"></i> <span
        class="disappear">RSS</span></a>
    <a class="decoration-line model" href="#" class="model"><i class="fa-solid fa-sun fa-xs"></i></a>
  </nav>
</header><main class="blog-main">
          <article class="blog-article">
            <h1>Docker</h1>
            <hr>
            <h2 id="docker-çš„åŸºæœ¬ç»„æˆ">Docker çš„åŸºæœ¬ç»„æˆ<a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#docker-çš„åŸºæœ¬ç»„æˆ"></a></h2>
<ol>
<li>é•œåƒæ—¶ä¸€ç§è½»é‡çº§ï¼Œå¯æ‰§è¡Œçš„ç‹¬ç«‹è½¯ä»¶åŒ…ï¼Œç”¨æ¥æ‰“åŒ…è½¯ä»¶è¿è¡Œç¯å¢ƒå’ŒåŸºäºè¿è¡Œç¯å¢ƒå¼€å‘çš„è½¯ä»¶ï¼Œå®ƒåŒ…å«è¿è¡ŒæŸä¸ªè½¯ä»¶æ‰€éœ€çš„æ‰€æœ‰å†…å®¹ï¼ŒåŒ…æ‹¬ä»£ç ï¼Œç¯å¢ƒè¿è¡Œæ—¶ï¼Œåº“ï¼Œç¯å¢ƒå˜é‡ç­‰</li>
<li><strong>å®¹å™¨ (container)</strong>:Docker åˆ©ç”¨å®¹å™¨æŠ€æœ¯ï¼Œç‹¬ç«‹è¿è¡Œä¸€ä¸ªï¼Œæˆ–è€…ä¸€ç»„åº”ç”¨ï¼Œé€šè¿‡é•œåƒæ¥åˆ›å»º
<ul>
<li>å®¹å™¨å¯ä»¥å¯åŠ¨ï¼Œåœæ­¢ï¼Œåˆ é™¤ç­‰åŸºæœ¬å‘½ä»¤</li>
<li>å¯ä»¥ç®€å•ç†è§£ä¸ºä¸€ä¸ªç®€å•çš„ linux ç³»ç»Ÿ</li>
</ul>
</li>
<li><strong>ä»“åº“ (repository)</strong>:å­˜æ”¾é•œåƒçš„åœ°æ–¹ (åˆ†ä¸ºç§æœ‰å’Œå…¬æœ‰)
<ul>
<li>ç”±äº Docker hub æ˜¯å›½å¤–çš„ (é…ç½®é•œåƒåŠ é€Ÿ)</li>
</ul>
</li>
</ol>
<h3 id="å®‰è£…-docker">å®‰è£… Docker<a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#å®‰è£…-docker"></a></h3>
<blockquote>
<p>å®˜æ–¹æ–‡æ¡£:<a href="https://docs.docker.com/engine/install/centos/">https://docs.docker.com/engine/install/centos/</a></p>
</blockquote>
<ol>
<li>
<p>å®‰è£…<code>yum-utils</code>åŒ…ï¼š<code>yum install -y yum-utils</code></p>
</li>
<li>
<p>è®¾ç½®é•œåƒçš„åº“ï¼š</p>
<ul>
<li><code>yum-config-manager</code>æ˜¯ä¸€ä¸ªç¨‹åºï¼Œå®ƒå¯ä»¥ç®¡ç†ä¸»è¦çš„ yum é…ç½®é€‰é¡¹ï¼Œåˆ‡æ¢å¯ç”¨æˆ–ç¦ç”¨çš„å­˜å‚¨åº“ï¼Œä»¥åŠæ·»åŠ æ–°çš„å­˜å‚¨åº“</li>
<li><code>ä½¿ç”¨--add-repoå¿«é€Ÿæ·»åŠ yumæº</code></li>
</ul>
<pre><code class="hl language-shell">yum-config-manager \
--add-repo \
https://download.docker.com/linux/centos/docker-ce.repo
</code></pre>
</li>
<li>
<p>æ›´æ–°è½¯ä»¶åŒ…çš„ç´¢å¼• Centos 8:<code>yum makecache</code>,å¦‚æœæ˜¯ 7:<code>yum makecache fast</code></p>
</li>
<li>
<p>å®‰è£… docker ç›¸å…³çš„æº (<code>docker-ce</code>ç¤¾åŒºç‰ˆï¼Œee ä¼ä¸šç‰ˆ)</p>
<pre><code class="hl language-shell">yum install docker-ce docker-ce-cli containerd.io
</code></pre>
<blockquote>
<p>å¦‚æœå®‰è£…ç‰¹å®šç‰ˆæœ¬çš„ docker<code>yum install docker-ce-&#x3C;VERSION_STRING> docker-ce-cli-&#x3C;VERSION_STRING> containerd.io</code></p>
</blockquote>
</li>
<li>
<p>å¯åŠ¨ docker:<code>systemctl start docker</code></p>
</li>
<li>
<p>ä½¿ç”¨<code>docker version</code>æ˜¯å¦å®‰è£…æˆåŠŸ</p>
</li>
<li>
<p>æµ‹è¯•ï¼š<code>docker run hello-world</code></p>
</li>
<li>
<p>æŸ¥çœ‹ä¸‹è½½çš„é•œåƒï¼š<code>docker images</code></p>
<pre><code class="hl language-shell">[root@VM-12-17-centos /]# docker images
REPOSITORY    TAG       IMAGE ID       CREATED        SIZE
hello-world   latest    feb5d9fea6a5   3 months ago   13.3kB
</code></pre>
</li>
<li>
<p>å¸è½½ docker</p>
<pre><code class="hl language-shell"><span class="hl-meta prompt_"># </span><span class="bash">å¸è½½ä¾èµ–</span>
yum remove docker-ce docker-ce-cli containerd.io
<span class="hl-meta prompt_"># </span><span class="bash">åˆ é™¤èµ„æº</span>
rm -rf /var/lib/docker # docker çš„é»˜è®¤å·¥ä½œè·¯å¾„
rm -rf /var/lib/containerd # https://www.51cto.com/article/677744.html
</code></pre>
</li>
</ol>
<h3 id="é…ç½®é•œåƒåŠ é€Ÿ">é…ç½®é•œåƒåŠ é€Ÿ<a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#é…ç½®é•œåƒåŠ é€Ÿ"></a></h3>
<blockquote>
<p>åœ¨é˜¿é‡Œäº‘çš„<code>å®¹å™¨æœåŠ¡é‡Œ</code>æ‰¾åˆ°<code>å®¹å™¨é•œåƒæœåŠ¡</code>,æ‰“å¼€<code>é•œåƒå·¥å…·</code>,æ‰“å¼€<code>é•œåƒåŠ é€Ÿå™¨</code></p>
</blockquote>
<pre><code class="hl language-shell">mkdir -p /etc/docker
tee /etc/docker/daemon.json &#x3C;&#x3C;-'EOF'
{
  "registry-mirrors": ["https://xxxxxx.mirror.aliyuncs.com"]
}
EOF
systemctl daemon-reload
systemctl restart docker
</code></pre>
<h3 id="docker-çš„å·¥ä½œåŸç†">docker çš„å·¥ä½œåŸç†<a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#docker-çš„å·¥ä½œåŸç†"></a></h3>
<blockquote>
<p>helloword çš„è¿è¡ŒåŸç†</p>
</blockquote>
<p><img src="https://media.githubusercontent.com/media/fwqaaq/fwqaaq.github.io/dev/src/picture/run%E7%9A%84%E8%BF%90%E8%A1%8C%E6%B5%81%E7%A8%8B.png" alt="run çš„è¿è¡Œæµç¨‹"></p>
<ul>
<li>å·¥ä½œæµç¨‹ï¼š
<ol>
<li>Docker æ˜¯ä¸€ä¸ª Client-Server ç»“æ„çš„ç³»ç»Ÿï¼ŒDocker çš„å®ˆæŠ¤è¿›ç¨‹è¿è¡Œåœ¨ä¸»æœºä¸Šã€‚é€šè¿‡ Socket ä»å®¢æˆ·ç«¯è®¿é—®</li>
<li><code>DockerServe</code>æ¥æ”¶åˆ°<code>Docker-Client</code>çš„æŒ‡ä»¤å°±ä¼šæ‰§è¡Œè¿™ä¸ªå‘½ä»¤</li>
</ol>
</li>
</ul>
<p><img src="https://media.githubusercontent.com/media/fwqaaq/fwqaaq.github.io/dev/src/picture/%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.png" alt="docker çš„å·¥ä½œæµç¨‹"></p>
<ul>
<li>docker ä¸è™šæ‹Ÿæœºå¯¹æ¯”</li>
</ul>
<p><img src="https://pic2.zhimg.com/50/v2-e30ef11428ac454d101f2b7d3ffc067e_720w.jpg?source=1940ef5c" alt="æ¯”è¾ƒ"></p>
<ol>
<li>Docker æœ‰æ¯”è™šæ‹Ÿæœºæ›´å°‘çš„æŠ½è±¡å±‚</li>
<li>docker åˆ©ç”¨æ˜¯å®¿ä¸»æœºçš„å†…æ ¸ï¼Œè™šæ‹Ÿæœºæ˜¯éœ€è¦ Guest OS</li>
<li>docker ä¸éœ€è¦åƒè™šæ‹Ÿæœºä¸€æ ·é‡æ–°åŠ è½½ä¸€ä¸ªæ“ä½œç³»ç»Ÿçš„å†…æ ¸ï¼Œé¿å…å¼•å¯¼ã€‚è™šæ‹Ÿæœºæ—¶åŠ è½½ Guset
OSï¼Œåˆ†é’Ÿçº§åˆ«çš„ï¼Œdocker æ—¶åˆ©ç”¨å®¿ä¸»æœºæ“ä½œç³»ç»Ÿï¼Œçœç•¥äº†è¿™ä¸ªå¤æ‚çš„åŠŸèƒ½</li>
</ol>
<p>| | Docker å®¹å™¨ | LXC | VM | | ---------- | ----------- | ----------- |
------------ | | è™šæ‹ŸåŒ–ç±»å‹ | OS è™šæ‹ŸåŒ– | OS è™šæ‹ŸåŒ– | OS è™šæ‹ŸåŒ– | | æ€§èƒ½ |
=ç‰©ç†æœºæ€§èƒ½ | =ç‰©ç†æœºæ€§èƒ½ | 5%-20% çš„æŸè€— | | éš”ç¦»æ€§ | NS éš”ç¦» | NS éš”ç¦» | å¼º | |
QoS | Cgroup å¼± | Cgroup å¼± | å¼º | | å®‰å…¨æ€§ | ä¸­ | å·® | å¼º | | GusetOS |
åªæ”¯æŒ Linux | åªæ”¯æŒ Linux | å…¨éƒ¨ | | å¯è¿ç§»æ€§ | å¼º | å¼± | å¼º |</p>
<h3 id="é•œåƒ-image"><strong>é•œåƒ (image)</strong><a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#é•œåƒ-image"></a></h3>
<blockquote>
<p>é•œåƒæ—¶ä¸€ç§è½»é‡çº§ï¼Œå¯æ‰§è¡Œçš„ç‹¬ç«‹è½¯ä»¶åŒ…ï¼Œç”¨æ¥æ‰“åŒ…è½¯ä»¶è¿è¡Œç¯å¢ƒå’ŒåŸºäºè¿è¡Œç¯å¢ƒå¼€å‘çš„è½¯ä»¶ï¼Œå®ƒåŒ…å«è¿è¡ŒæŸä¸ªè½¯ä»¶æ‰€éœ€çš„æ‰€æœ‰å†…å®¹ï¼ŒåŒ…æ‹¬ä»£ç ï¼Œç¯å¢ƒè¿è¡Œæ—¶ï¼Œåº“ï¼Œç¯å¢ƒå˜é‡ç­‰</p>
</blockquote>
<ol>
<li>ä¾‹å¦‚<code>tomcaté•œåƒ</code>è¿è¡Œèµ·æ¥ä¹‹å<code>tomcat01å®¹å™¨</code>æ¥æä¾›æœåŠ¡</li>
<li>å¹¶ä¸”è¿™ä¸ªé•œåƒå¯ä»¥åˆ›å»ºå¤šä¸ªå®¹å™¨ (æœ€ç»ˆæœåŠ¡è¿è¡Œæˆ–è€…é¡¹ç›®è¿è¡Œå®åœ¨å®¹å™¨ä¸­)</li>
<li>æ‰€æœ‰çš„åº”ç”¨é€šè¿‡ docker åº”ç”¨æ‰“åŒ…ï¼Œå¯ä»¥ç›´æ¥è·‘èµ·æ¥</li>
</ol>
<blockquote>
<p>é•œåƒè·å–çš„æ–¹æ³•</p>
</blockquote>
<ol>
<li>ä»è¿œç¨‹ä»“åº“ä¸‹è½½</li>
<li>æ‹·è´åˆ«äººçš„é•œåƒ</li>
<li>è‡ªå·±åˆ¶ä½œä¸€ä¸ª <code>DockerFile</code></li>
</ol>
<h4 id="docker-é•œåƒåŠ è½½çš„åŸºæœ¬åŸç†">Docker é•œåƒåŠ è½½çš„åŸºæœ¬åŸç†<a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#docker-é•œåƒåŠ è½½çš„åŸºæœ¬åŸç†"></a></h4>
<blockquote>
<p>UnionFS(è”åˆæ–‡ä»¶ç³»ç»Ÿ):ä¸‹è½½çš„æ—¶å€™ä¸€å±‚ä¸€å±‚çš„è¾“å‡ºå°±æ˜¯è¿™ä¸ª</p>
</blockquote>
<ul>
<li><strong>UnionFS(è”åˆæ–‡ä»¶ç³»ç»Ÿ)</strong>:Union æ–‡ä»¶ç³»ç»Ÿ (UnifonFS) æ˜¯ä¸€ç§åˆ†å±‚ï¼Œåˆ†é‡çº§å¹¶ä¸”é«˜æ€§èƒ½çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒæ”¯æŒå¯¹æ–‡ä»¶ç³»ç»Ÿçš„ä¿®æ”¹ä½œä¸ºä¸€æ¬¡æäº¤æ¥ä¸€å±‚å±‚çš„å åŠ ï¼ŒåŒæ—¶å¯ä»¥å°†ä¸åŒçš„ç›®å½•æŒ‚è½½åˆ°ä¸€ä¸ªè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿä¸‹ (<code>unite serveral directories into a single virtual filesystem</code>).Union
æ–‡ä»¶ç³»ç»Ÿæ—¶ Docker é•œåƒçš„åŸºç¡€ï¼Œé•œåƒå¯ä»¥é€šè¿‡åˆ†å±‚ç±»è¿›è¡Œç»§æ‰¿ï¼ŒåŸºäºé•œåƒ (æ²¡æœ‰çˆ¶é•œåƒ),å¯ä»¥åˆ¶ä½œå„ç§å…·ä½“çš„åº”ç”¨é•œåƒ</li>
<li><strong>ç‰¹æ€§</strong>:ä¸€æ¬¡åŒæ—¶åŠ è½½å¤šä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œä½†æ˜¯ä»å¤–é¢çœ‹åªèƒ½çœ‹åˆ°ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œè”åˆåŠ è½½ä¼šæŠŠå„å±‚æ–‡ä»¶ç³»ç»Ÿå åŠ èµ·æ¥ï¼Œè¿™æ ·æœ€ç»ˆæ–‡ä»¶ç³»ç»Ÿä¼šåŒ…å«æ‰€æœ‰åº•å±‚çš„æ–‡ä»¶å’Œç›®å½• (ä¾‹å¦‚åº•å±‚çš„ centos æ–‡ä»¶ä¼šç»™æ‰€æœ‰çš„å®¹å™¨ä½¿ç”¨)</li>
</ul>
<blockquote>
<p>Docker é•œåƒåŠ è½½åŸç†</p>
</blockquote>
<ul>
<li>docker é•œåƒå®é™…å®¤å‹ä¸€å±‚ä¸€å±‚æ–‡ä»¶ç³»ç»Ÿç»„æˆ</li>
<li><strong>bootfs(boot file
system)</strong>:åŒ…å« bootloader å’Œ kernel.<code>bootloader</code>ä¸»è¦åŠ è½½<code>kernel</code>.Linux åˆšå¯åŠ¨ä¼šåŠ è½½ bootfs æ–‡ä»¶ç³»ç»Ÿï¼Œåœ¨ Docker é•œåƒæœ€åº•å±‚å°±æ˜¯ bootfsï¼Œå¹¶ä¸”ä¸å…¸å‹çš„ Linux/Unix ç³»ç»Ÿæ˜¯ä¸€æ ·çš„ï¼ŒåŒ…å« bootf åŠ è½½å™¨å’Œå†…æ ¸ã€‚å½“ bootf åŠ è½½å®Œæˆä¹‹åæ•´ä¸ªå†…æ ¸å°±åœ¨<strong>å†…å­˜</strong>ä¸­ï¼Œæ­¤æ—¶çš„å†…å­˜ä½¿ç”¨æƒå°±æœ‰ bootfs è½¬äº¤ç»™å†…æ ¸ï¼Œç³»ç»Ÿå¸è½½ bootfs</li>
<li><strong>rootfs(root file
system)</strong>:åœ¨ bootfs ä¹‹ä¸Šã€‚åŒ…å«çš„å°±æ˜¯å…¸å‹çš„ Linux ç³»ç»Ÿä¸­çš„<code>/dev,/bin,/usr</code>ç­‰.rootfs å°±æ˜¯ä¸åŒæ“ä½œç³»ç»Ÿçš„å‘è¡Œç‰ˆï¼Œæ¯”å¦‚<code>Ubuntu</code>,<code>Centos</code>ç­‰</li>
</ul>
<p><img src="https://media.githubusercontent.com/media/fwqaaq/fwqaaq.github.io/dev/src/picture/docker%E9%95%9C%E5%83%8F%E5%8A%A0%E8%BD%BD%E5%8E%9F%E7%90%86.png" alt=" "></p>
<ul>
<li>å¯¹äºç²¾ç®€è¿‡çš„ OS(æ“ä½œç³»ç»Ÿ),rootfs å¯ä»¥å¾ˆå°ï¼Œåªéœ€è¦æœ€åŸºæœ¬çš„å‘½ä»¤ã€‚å·¥å…·å’Œç¨‹åºåº“å°±å¯ä»¥äº†ï¼Œåº•å±‚ä½¿ç”¨ä¸»æœºçš„å†…æ ¸å°±å¯ä»¥äº†ï¼Œè‡ªå·±åªéœ€è¦æä¾› rootfs.</li>
</ul>
<blockquote>
<p>åˆ†å±‚ç†è§£</p>
</blockquote>
<ol>
<li>æ‰€æœ‰çš„ Docker é•œåƒéƒ½èµ·å§‹äºä¸€ä¸ªåŸºç¡€é•œåƒï¼Œå½“é‡‘æ˜Ÿä¿®æ”¹æˆ–å¢åŠ æ–°çš„å†…å®¹æ—¶ï¼Œå°±ä¼šåœ¨å½“å‰çš„é•œåƒå±‚ä¹‹ä¸Šï¼Œåˆ›å»ºæ–°çš„é•œåƒå±‚
<ul>
<li>ä¾‹å¦‚ Centos åˆ›å»ºä¸€ä¸ªæ–°çš„é•œåƒï¼Œæ­¤é•œåƒä½äºç¬¬ä¸€å±‚ï¼Œå¦‚æœåœ¨è¯¥é•œåƒä¸­åŠ å…¥ Python åŒ…ï¼Œå°±ä¼šåœ¨åŸºç¡€é•œåƒå±‚ä¸Šåˆ›å»ºç¬¬äºŒä¸ªé•œåƒå±‚;å¦‚æœç»§ç»­æ·»åŠ ï¼Œå°±ä¼šåˆ›å»ºç¬¬ä¸‰ä¸ªé•œåƒå±‚</li>
</ul>
</li>
<li>åœ¨æ·»åŠ é¢å¤–é•œåƒçš„åŒæ—¶ï¼Œé•œåƒå§‹ç»ˆä¿æŒæ‰€æœ‰é•œåƒçš„ç»„åˆã€‚
<ul>
<li>
<p>ä¾‹å¦‚ä¸‹å›¾ä¸­ï¼Œæ¯ä¸ªå±‚ä¸­éƒ½æœ‰ä¸‰ä¸ªæ–‡ä»¶ï¼Œä¸”ä¿æŒç›¸äº’éš”ç¦»</p>
<p><img src="https://media.githubusercontent.com/media/fwqaaq/fwqaaq.github.io/dev/src/picture/dcoker%E4%B8%AD%E7%9A%84%E5%88%86%E5%B1%82.png" alt=" "></p>
</li>
</ul>
</li>
</ol>
<blockquote>
<p>ç‰¹ç‚¹</p>
</blockquote>
<ol>
<li>docker é•œåƒéƒ½æ˜¯åªè¯»çš„ï¼Œå½“å®¹å™¨å¯åŠ¨ï¼Œä¸€ä¸ªæ–°çš„ç§‘åæ›¾è¢«åŠ è½½åˆ°é•œåƒçš„é¡¶éƒ¨</li>
<li>è¿™ä¸€å±‚é€šå¸¸æ˜¯å®¹å™¨å±‚ï¼Œå®¹å™¨ä¹‹ä¸‹éƒ½æ˜¯é•œåƒå±‚</li>
</ol>
<p><img src="https://media.githubusercontent.com/media/fwqaaq/fwqaaq.github.io/dev/src/picture/docker%E9%95%9C%E5%83%8F%E7%9A%84%E7%89%B9%E7%82%B9.png" alt="docker é•œåƒçš„ç‰¹ç‚¹"></p>
<h3 id="commit-é•œåƒ">Commit é•œåƒ<a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#commit-é•œåƒ"></a></h3>
<ol>
<li><code>docker commit -m="æäº¤ä¿¡æ¯" -a="ä½œè€…"</code> æäº¤å®¹å™¨æˆä¸ºä¸€ä¸ªæ–°çš„å‰¯æœ¬</li>
<li>å¯ä»¥ä½¿ç”¨<code>docker images</code>,æŸ¥çœ‹è‡ªå·±ä¿å­˜çš„é•œåƒ</li>
</ol>
<h2 id="docker-å¸¸ç”¨å‘½ä»¤">Docker å¸¸ç”¨å‘½ä»¤<a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#docker-å¸¸ç”¨å‘½ä»¤"></a></h2>
<blockquote>
<p>å‚è€ƒæ–‡æ¡£:<a href="https://docs.docker.com/reference/">https://docs.docker.com/reference/</a></p>
</blockquote>
<h3 id="å¸®åŠ©å‘½ä»¤">å¸®åŠ©å‘½ä»¤<a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#å¸®åŠ©å‘½ä»¤"></a></h3>
<ol>
<li><code>docker version</code>:æ˜¾ç¤º docker çš„ç‰ˆæœ¬ä¿¡æ¯</li>
<li><code>docker info</code>:æ˜¾ç¤º docker çš„ç³»ç»Ÿä¿¡æ¯ï¼ŒåŒ…æ‹¬é•œåƒå’Œå®¹å™¨çš„æ•°é‡</li>
<li><code>docker å‘½ä»¤ --help</code>:å¸®åŠ©å‘½ä»¤</li>
</ol>
<h3 id="é•œåƒå‘½ä»¤">é•œåƒå‘½ä»¤<a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#é•œåƒå‘½ä»¤"></a></h3>
<ul>
<li><code>docker images</code>:æŸ¥çœ‹æ‰€æœ‰æœ¬åœ°ä¸»æœºä¸Šçš„é•œåƒ</li>
</ul>
<pre><code class="hl language-shell">[root@VM-12-17-centos /]# docker images
REPOSITORY    TAG       IMAGE ID       CREATED        SIZE
hello-world   latest    feb5d9fea6a5   3 months ago   13.3kB
<span class="hl-meta prompt_">
# </span><span class="bash">å¯é€‰é¡¹</span>
  -a, --all     # åˆ—å‡ºæ‰€æœ‰çš„é•œåƒ
  -q, --quiet   # åªæ˜¾ç¤ºé•œåƒçš„ID
</code></pre>
<ol>
<li><code>REPOSITORY</code>:é•œåƒçš„ä»“åº“æº</li>
<li><code>TAG</code>:é•œåƒçš„æ ‡ç­¾</li>
<li><code>IMAGE ID</code>:é•œåƒçš„ ID</li>
<li><code>CREATED</code>:é•œåƒçš„åˆ›å»ºæ—¶é—´</li>
<li><code>SIZE</code>:é•œåƒçš„å¤§å°</li>
</ol>
<ul>
<li><code>docker search é•œåƒ</code>:æœç´¢é•œåƒ</li>
</ul>
<pre><code class="hl language-shell">[root@VM-12-17-centos /]# docker search mysql
NAME                              DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED
mysql                             MySQL is a widely used, open-source relationâ€¦   11997     [OK]       
mariadb                           MariaDB Server is a high performing open souâ€¦   4595      [OK]       
mysql/mysql-server                Optimized MySQL Server Docker images. Createâ€¦   899                  [OK]
<span class="hl-meta prompt_">
# </span><span class="bash">å¯é€‰é¡¹,é€šè¿‡æœç´¢æ¥è¿‡æ»¤</span>
--filter = STARS = 3000  æœç´¢å‡ºçš„é•œåƒæ˜¯STARS>3000çš„
</code></pre>
<ul>
<li><code>docker pull</code>ä¸‹è½½é•œåƒ</li>
</ul>
<pre><code class="hl language-shell"><span class="hl-meta prompt_"># </span><span class="bash">ä¸‹è½½é•œåƒ docker pull é•œåƒå[:tags]</span>
[root@VM-12-17-centos /]# docker pull mongo
Using default tag: latest # å¦‚æœä¸å±‘tag,é»˜è®¤å°±æ˜¯latest
latest: Pulling from library/mongo
7b1a6ab2e44d: Pull complete # åˆ†å±‚ä¸‹è½½,docker imageçš„æ ¸å¿ƒ  è”åˆæ–‡ä»¶ç³»ç»Ÿ
90eb44ebc60b: Pull complete 
5085b59f2efb: Pull complete 
c7499923d022: Pull complete 
019496b6c44a: Pull complete 
c0df4f407f69: Pull complete 
351daa315b6c: Pull complete 
a233e6240acc: Pull complete 
a3f57d6be64f: Pull complete 
dd1b5b345323: Pull complete 
Digest: sha256:5be752bc5f2ac4182252d0f15d74df080923aba39700905cb26d9f70f39e9702 # ç­¾å
Status: Downloaded newer image for mongo:latest
docker.io/library/mongo:latest # çœŸå®åœ°å€
<span class="hl-meta prompt_">
# </span><span class="bash">ä¸‹é¢ä¸¤è€…ç­‰ä»·</span>
docker pull docker.io/library/mongo:latest
docker pull mysql
<span class="hl-meta prompt_">
# </span><span class="bash">æŒ‡å®šç‰ˆæœ¬ä¸‹è½½</span>
docker pull mongo:3.1
</code></pre>
<ul>
<li><code>docker rmi</code>:åˆ é™¤é•œåƒ</li>
</ul>
<pre><code class="hl language-shell">docker rmi -f é•œåƒid # åˆ é™¤æŒ‡å®šçš„é•œåƒ
docker rmi -f é•œåƒid é•œåƒid   # åˆ é™¤å¤šä¸ªæŒ‡å®šçš„é•œåƒ
docker rmi -f $(docker images -aq) # åˆ é™¤å…¨éƒ¨çš„é•œåƒ
</code></pre>
<h3 id="å®¹å™¨å‘½ä»¤">å®¹å™¨å‘½ä»¤<a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#å®¹å™¨å‘½ä»¤"></a></h3>
<blockquote>
<p>ä¸‹è½½ centos é•œåƒæ¥æµ‹è¯•<code>docker pull centos</code></p>
</blockquote>
<h4 id="æ–°å»ºå®¹å™¨å¹¶å¯åŠ¨">æ–°å»ºå®¹å™¨å¹¶å¯åŠ¨<a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#æ–°å»ºå®¹å™¨å¹¶å¯åŠ¨"></a></h4>
<ul>
<li><strong>docker run [å¯é€‰å‚æ•°] image</strong></li>
</ul>
<blockquote>
<p>å‚æ•°è¯´æ˜</p>
</blockquote>
<ul>
<li>--name="Name" å®¹å™¨åå­— tomcat01 tomcat01ï¼Œç”¨æ¥åŒºåˆ†å®¹å™¨</li>
<li>-d åå°æ–¹å¼è¿è¡Œ</li>
<li>-it ä½¿ç”¨äº¤äº’æ–¹å¼è¿è¡Œï¼Œè¿›å…¥å®¹å™¨çœ‹å†…å®¹</li>
<li>-p æŒ‡å®šå®¹å™¨çš„ç«¯å£ -p 8080:8080
<ul>
<li>-p ip:ä¸»æœºç«¯å£ï¼šå®¹å™¨ç«¯å£</li>
<li>-p ä¸»æœºç«¯å£ï¼šå®¹å™¨ç«¯å£ (å¸¸ç”¨)</li>
<li>ip å®¹å™¨ç«¯å£</li>
<li>å®¹å™¨ç«¯å£</li>
</ul>
</li>
<li>-P éšæœºæŒ‡å®šç«¯å£</li>
</ul>
<pre><code class="hl language-shell"><span class="hl-meta prompt_"># </span><span class="bash">æµ‹è¯•,å¯åŠ¨å¹¶è¿›å…¥å®¹å™¨</span>
[root@VM-12-17-centos /]# docker run -it centos /bin/bash
[root@12164c10567a /]# ls
bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var
</code></pre>
<h4 id="åˆ—å‡ºæ‰€æœ‰çš„è¿è¡Œå®¹å™¨">åˆ—å‡ºæ‰€æœ‰çš„è¿è¡Œå®¹å™¨<a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#åˆ—å‡ºæ‰€æœ‰çš„è¿è¡Œå®¹å™¨"></a></h4>
<ul>
<li><strong>docker ps</strong>:åˆ—å‡ºæ­£åœ¨è¿è¡Œçš„å®¹å™¨
<ul>
<li><code>-a</code>:åˆ—å‡ºæ­£åœ¨è¿è¡Œçš„å®¹å™¨å¹¶å¸¦å‡ºå†å²è¿è¡Œè¿‡çš„å®¹å™¨</li>
<li><code>-n=?</code>:æ˜¾ç¤ºæœ€è¿‘åˆ›å»ºè¿‡çš„å®¹å™¨ï¼Œä¾‹å¦‚<code>-n=1</code>æ˜¾ç¤ºæœ€è¿‘çš„ä¸€ä¸ªå®¹å™¨</li>
<li><code>-q</code>:åªæ˜¾ç¤ºå®¹å™¨ç¼–å·</li>
</ul>
</li>
</ul>
<h4 id="é€€å‡ºå®¹å™¨">é€€å‡ºå®¹å™¨<a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#é€€å‡ºå®¹å™¨"></a></h4>
<ul>
<li><strong>exit</strong>:ç›´æ¥é€€å‡ºå®¹å™¨å¹¶åœæ­¢</li>
<li><code>Ctrl+P+Q</code>:å®¹å™¨ä¸åœæ­¢é€€å‡º</li>
</ul>
<h4 id="åˆ é™¤å®¹å™¨">åˆ é™¤å®¹å™¨<a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#åˆ é™¤å®¹å™¨"></a></h4>
<ul>
<li><strong>docker rm
å®¹å™¨ id</strong>:åˆ é™¤é•œæŒ‡å®šçš„å®¹å™¨ï¼Œä¸èƒ½åˆ é™¤æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼Œå¦‚æœå¼ºåˆ¶åˆ é™¤<code>rm -f</code></li>
</ul>
<pre><code class="hl language-shell">docker rm -f $(docker ps -aq) # åˆ é™¤å…¨éƒ¨çš„å®¹å™¨
docker ps -a -q|xargs docker rm   # åˆ é™¤æ‰€æœ‰çš„å®¹å™¨
</code></pre>
<h4 id="å¯åŠ¨å’Œåœæ­¢å®¹å™¨çš„æ“ä½œ">å¯åŠ¨å’Œåœæ­¢å®¹å™¨çš„æ“ä½œ<a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#å¯åŠ¨å’Œåœæ­¢å®¹å™¨çš„æ“ä½œ"></a></h4>
<ul>
<li><strong>docker start å®¹å™¨ id</strong>:å¯åŠ¨å®¹å™¨</li>
<li><strong>docker restart å®¹å™¨ id</strong>:é‡å¯å®¹å™¨</li>
<li><strong>docker stop å®¹å™¨ id</strong>:åœæ­¢å½“å‰å®¹å™¨</li>
<li><strong>docker kill å®¹å™¨ id</strong>:å¼ºåˆ¶åœæ­¢å®¹å™¨</li>
</ul>
<h3 id="å¸¸ç”¨çš„å…¶å®ƒå‘½ä»¤">å¸¸ç”¨çš„å…¶å®ƒå‘½ä»¤<a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#å¸¸ç”¨çš„å…¶å®ƒå‘½ä»¤"></a></h3>
<h4 id="åå°å¯åŠ¨å®¹å™¨">åå°å¯åŠ¨å®¹å™¨<a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#åå°å¯åŠ¨å®¹å™¨"></a></h4>
<ul>
<li><strong>docker run -d é•œåƒå</strong></li>
</ul>
<pre><code class="hl language-shell">[root@VM-12-17-centos /]# docker run -d centos
<span class="hl-meta prompt_">
# </span><span class="bash">docker ps:å‘ç°centosåœæ­¢äº†</span>
</code></pre>
<ul>
<li>å¸¸è§çš„é—®é¢˜ï¼š
<ol>
<li>docker å®¹å™¨ä½¿ç”¨åå°è¿è¡Œï¼Œå°±å¿…é¡»æœ‰ä¸€ä¸ªå‰å°è¿›ç¨‹ï¼Œdocker å‘ç°æ²¡æœ‰åº”ç”¨ï¼Œå°±ä¼šè‡ªåŠ¨åœæ­¢</li>
<li>ä¾‹å¦‚ nginx å®¹å™¨å¯åŠ¨åï¼Œå‘ç°è‡ªå·±æ²¡æœ‰æä¾›æœåŠ¡å°±ä¼šè‡ªåŠ¨åœæ­¢</li>
</ol>
</li>
</ul>
<h4 id="æŸ¥çœ‹æ—¥å¿—">æŸ¥çœ‹æ—¥å¿—<a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#æŸ¥çœ‹æ—¥å¿—"></a></h4>
<ul>
<li><strong>docker -f -t --tail</strong>
<ul>
<li><code>-f</code>:æ˜¾ç¤ºæ—¥å¿—</li>
<li><code>-t</code>:å¸¦ä¸Šæ—¶é—´æˆ³</li>
<li><code>--tail</code>:æ˜¾ç¤ºå¤šå°‘æ¡æ—¥å¿—</li>
</ul>
</li>
</ul>
<pre><code class="hl language-shell">docker -f -t --tail 10 af1770f5884f
</code></pre>
<h4 id="æŸ¥çœ‹å®¹å™¨å†…éƒ¨çš„è¿›ç¨‹å‘½ä»¤">æŸ¥çœ‹å®¹å™¨å†…éƒ¨çš„è¿›ç¨‹å‘½ä»¤<a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#æŸ¥çœ‹å®¹å™¨å†…éƒ¨çš„è¿›ç¨‹å‘½ä»¤"></a></h4>
<ul>
<li><strong>docker top å®¹å™¨ id</strong></li>
</ul>
<pre><code class="hl language-shell">[root@VM-12-17-centos ~]# docker top 4fc2d1f7bf97
UID                 PID                  PPID    C         STIME               TTY                 TIME                CMD
root                12339               12319    0        15:58               pts/0               00:00:00            /bin/bash
</code></pre>
<h4 id="æŸ¥çœ‹å®¹å™¨çš„å…ƒæ•°æ®-é‡è¦">æŸ¥çœ‹å®¹å™¨çš„å…ƒæ•°æ® (é‡è¦)<a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#æŸ¥çœ‹å®¹å™¨çš„å…ƒæ•°æ®-é‡è¦"></a></h4>
<ul>
<li><strong>docker inspect é•œåƒ/å®¹å™¨ id</strong></li>
</ul>
<pre><code class="hl language-shell">[root@VM-12-17-centos ~]# docker inspect 7a447721e405
</code></pre>
<h4 id="è¿›å…¥å½“å‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨">è¿›å…¥å½“å‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨<a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#è¿›å…¥å½“å‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨"></a></h4>
<blockquote>
<p>é€šå¸¸å®¹å™¨éƒ½æ˜¯ä½¿ç”¨åå°æ–¹å¼è¿è¡Œã€‚éœ€è¦è¿›å…¥å®¹å™¨ä¿®æ”¹ä¸€äº›é…ç½®</p>
</blockquote>
<ul>
<li><strong>docker exec -it å®¹å™¨ id bashShell</strong>/<strong>docker attach å®¹å™¨ id</strong></li>
</ul>
<ol>
<li>ç¬¬ä¸€ç§ï¼š<code>docker exec -it 7a447721e405 /bin/bash</code></li>
<li>ç¬¬äºŒç§ï¼š<code>docker attach 7a447721e405</code></li>
</ol>
<ul>
<li>æ³¨æ„ï¼šç¬¬ä¸€ä¸ªæ˜¯è¿›å…¥å®¹å™¨åå¼€å¯ä¸€ä¸ªæ–°çš„ç»ˆç«¯ï¼Œç¬¬äºŒä¸ªæ˜¯è¿›å…¥ä¸€ä¸ªå®¹å™¨æ­£åœ¨æ‰§è¡Œçš„ç»ˆç«¯</li>
</ul>
<h4 id="ä»å®¹å™¨ä¸­æ‹·è´åˆ°ä¸»æœºä¸Š">ä»å®¹å™¨ä¸­æ‹·è´åˆ°ä¸»æœºä¸Š<a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#ä»å®¹å™¨ä¸­æ‹·è´åˆ°ä¸»æœºä¸Š"></a></h4>
<ul>
<li><strong>docker cp</strong></li>
</ul>
<blockquote>
<p>å°†å·²ç»åœæ­¢çš„å®¹å™¨ä¸­çš„å†…å®¹æ‹·è´åˆ°ä¸»æœº</p>
</blockquote>
<pre><code class="hl language-shell">[root@VM-12-17-centos /]# docker cp 7a447721e405:/home/test.md /home
</code></pre>
<blockquote>
<p>ä½¿ç”¨-v å·çš„æŠ€æœ¯å¯ä»¥å®ç°è‡ªåŠ¨åŒæ­¥</p>
</blockquote>
<h4 id="æŸ¥çœ‹-cpu-çŠ¶æ€">æŸ¥çœ‹ cpu çŠ¶æ€<a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#æŸ¥çœ‹-cpu-çŠ¶æ€"></a></h4>
<ul>
<li><strong>docker stats</strong>:æŸ¥çœ‹ docker çš„ cpu çŠ¶æ€</li>
</ul>
<h3 id="æ€»ç»“">æ€»ç»“<a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#æ€»ç»“"></a></h3>








































































































































































































<table><thead><tr><th>å‘½ä»¤</th><th>åŸæ–‡</th><th>è¯‘</th></tr></thead><tbody><tr><td>attach</td><td>Attach to a running container</td><td>å½“å‰ shel11 ä¸‹ attach è¿æ¥æŒ‡å®šè¿è¡Œé•œåƒ</td></tr><tr><td>build</td><td>Build an image from a Dockerfile</td><td>é€šè¿‡ Dockerfile å®šåˆ¶é•œåƒ</td></tr><tr><td>commit</td><td>Create a new image from a container changes</td><td>æäº¤å½“å‰å®¹å™¨ä¸ºæ–°çš„é•œåƒ</td></tr><tr><td>cp</td><td>Copy files/folders from the containers filesystem to the host path</td><td>ä»å®¹å™¨ä¸­æ‹·è´æŒ‡å®šæ–‡ä»¶æˆ–è€…ç›®å½•åˆ°å®¿ä¸»æœºä¸­</td></tr><tr><td>create</td><td>Create a new container</td><td>åˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨ï¼ŒåŒ run, ä½†ä¸å¯åŠ¨å®¹å™¨</td></tr><tr><td>diff</td><td>Inspect changes on a container's filesys tem</td><td>æŸ¥çœ‹ docker å®¹å™¨å˜åŒ–</td></tr><tr><td>events</td><td>Get rea1 time events from the server</td><td>ä» docker æœåŠ¡è·å–å®¹å™¨å®æ—¶äº‹ä»¶</td></tr><tr><td>exec</td><td>Run a command in an existing container</td><td>åœ¨å·²å­˜åœ¨çš„å®¹å™¨ ä¸Šè¿è¡Œå‘½ä»¤</td></tr><tr><td>export</td><td>Stream the contents of a container as a tar archive</td><td>å¯¼å‡ºå®¹å™¨çš„å†…å®¹æµä½œä¸ºä¸€ä¸ª tar å½’æ¡£æ–‡ä»¶[å¯¹åº” import ]</td></tr><tr><td>history</td><td>Show the history of an image</td><td>å±•ç¤ºä¸€ä¸ªé•œåƒå½¢æˆå†å²</td></tr><tr><td>images</td><td>List images</td><td>åˆ—å‡ºç³»ç»Ÿå½“å‰é•œåƒï¼š</td></tr><tr><td>import</td><td>Create a new filesystem image from the contents of a tarba1l</td><td>ä» tar åŒ…ä¸­çš„å†…å®¹åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ç³»ç»Ÿé•œåƒ[å¯¹åº” export]</td></tr><tr><td>info</td><td>Display sys tem-wide i nformation</td><td>æ˜¾ç¤ºç³»ç»Ÿç›¸å…³ä¿¡æ¯</td></tr><tr><td>inspect</td><td>Return 1ow-1eve1 information on a container</td><td>æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯</td></tr><tr><td>kill</td><td>Ki11 a running container</td><td>ki1l æŒ‡å®š docker å®¹å™¨</td></tr><tr><td>load</td><td>Load an image from a tar archive</td><td>ä»ä¸€ä¸ª tar åŒ…ä¸­åŠ è½½ä¸€ä¸ªé•œåƒ[å¯¹åº” save]</td></tr><tr><td>login</td><td>Register or Login to the docker registry server</td><td>ä½å†Œæˆ–è€…ç™»é™†ä¸€ä¸ª docker æºæœåŠ¡å™¨</td></tr><tr><td>logout</td><td>Log out from a Docker registry server</td><td>ä»å½“å‰ Docker registry é€€å‡º</td></tr><tr><td>1ogs</td><td>Fetch the 1ogs of a container</td><td>è¾“å‡ºå½“å‰å®¹å™¨æ—¥å¿—ä¿¡æ¯</td></tr><tr><td>port</td><td>lookup the public-facing port which is NAT-ed to PRIVATE_ PORT</td><td>æŸ¥çœ‹æ˜ å°„ç«¯å£å¯¹åº”çš„å®¹å™¨å†…éƒ¨æºç«¯</td></tr><tr><td>pause</td><td>Pause a11 processes within a container</td><td>æš‚åœå®¹å™¨</td></tr><tr><td>ps</td><td>List containers</td><td>åˆ—å‡ºå®¹å™¨åˆ—è¡¨</td></tr><tr><td>pull</td><td>Pull an image or a repository from the docker registry server</td><td>ä» docker é•œåƒæºæœåŠ¡å™¨æ‹‰å–æŒ‡å®šé•œåƒæˆ–è€…åº“é•œåƒ</td></tr><tr><td>push</td><td>Push an image or a repository to the docker registry server</td><td>æ¨é€æŒ‡å®šé•œåƒæˆ–è€…åº“é•œåƒè‡³ docker æºæœåŠ¡å™¨</td></tr><tr><td>restart</td><td>Restart a running container</td><td>é‡å¯è¿è¡Œçš„å®¹å™¨</td></tr><tr><td>rm</td><td>Remove one or more : containers</td><td>ç§»é™¤ä¸€ä¸ªæˆ–è€…å¤šä¸ªå®¹å™¨</td></tr><tr><td>rmi</td><td>Remove one or more images</td><td>ç§»é™¤ä¸€ä¸ªæˆ–å¤šä¸ªé•œåƒ[æ— å®¹å™¨ä½¿ç”¨è¯¥é•œåƒæ‰å¯åˆ é™¤ï¼Œå¦åˆ™éœ€åˆ é™¤ç›¸å…³å®¹å™¨æ‰å¯ç»§ç»­æˆ–-f å¼ºåˆ¶åˆ é™¤]</td></tr><tr><td>run</td><td>Run a command in a . new container</td><td>åˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨å¹¶è¿è¡Œä¸€ä¸ªå‘½ä»¤</td></tr><tr><td>save</td><td>Save an image to a tar archive</td><td>ä¿å­˜ä¸€ä¸ªé•œåƒä¸ºä¸€ä¸ª tar åŒ…[å¯¹åº” load]</td></tr><tr><td>search</td><td>Search for an image on the Docker Hub</td><td>åœ¨ docker hub ä¸­æœç´¢é•œåƒ</td></tr><tr><td>start</td><td>Start a stopped containers</td><td>å¯åŠ¨å®¹å™¨</td></tr><tr><td>stop</td><td>Stop a running containers</td><td>åœæ­¢å®¹å™¨</td></tr><tr><td>tag</td><td>Tag an image into a repository</td><td>ç»™æºä¸­é•œåƒæ‰“æ ‡ç­¾</td></tr><tr><td>stats</td><td>Display a live stream of container(s) resource usage statistics</td><td>æŸ¥çœ‹ cpu çŠ¶æ€</td></tr><tr><td>top</td><td>Lookup the running processes of a container</td><td>æŸ¥çœ‹å®¹å™¨ä¸­è¿è¡Œçš„è¿›ç¨‹ä¿¡æ¯</td></tr><tr><td>unpause</td><td>Unpause a paused container</td><td>å–æ¶ˆæš‚åœå®¹å™¨</td></tr><tr><td>version</td><td>Show the docker vers ion information</td><td>æŸ¥çœ‹ docker ç‰ˆæœ¬å·</td></tr><tr><td>wait</td><td>B1ock until a container stops, then print its exit code</td><td>æˆªå–å®¹å™¨åœæ­¢æ—¶çš„é€€å‡ºçŠ¶æ€å€¼</td></tr></tbody></table>
<h2 id="æ¡ˆåˆ—">æ¡ˆåˆ—<a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#æ¡ˆåˆ—"></a></h2>
<blockquote>
<p>ä»¥è£… nginx ä¸ºä¾‹</p>
</blockquote>
<ol>
<li>æœç´¢é•œåƒï¼š<code>docker search nginx</code>(dockerhub æ›´æ–¹ä¾¿)</li>
<li>ä¸‹è½½é•œåƒï¼š<code>docker pull nginx</code></li>
<li>æŸ¥æ‰¾é•œåƒï¼š<code>docker images</code></li>
<li>ä»¥åå°æ–¹å¼è¿è¡Œå®¹å™¨ï¼Œæ”¹åå¹¶ä¸”æ˜ å°„ç«¯å£åï¼š<code>docker run -d --name nginx01 -p 3401:80 nginx</code></li>
<li>æŸ¥çœ‹è¿è¡Œçš„å®¹å™¨ï¼š<code>docker ps</code></li>
<li>æµ‹è¯•å®¹å™¨æ˜¯å¦æˆåŠŸï¼š<code>curl localhost:3401</code></li>
<li>è¿›å…¥å®¹å™¨å†…éƒ¨ï¼š<code>docker exec -it nginx01 /bin/bash</code></li>
<li>åœæ­¢å®¹å™¨ï¼š<code>docker stop nginx01</code></li>
<li>åˆ é™¤æŒ‡å®šå®¹å™¨ï¼š<code>docker rm nginx01</code></li>
</ol>
<p><img src="https://media.githubusercontent.com/media/fwqaaq/fwqaaq.github.io/dev/src/picture/%E7%AB%AF%E5%8F%A3%E6%9A%B4%E9%9C%B2.png" alt="ç«¯å£æš´éœ²"></p>
<blockquote>
<p>å®‰è£…<code>tomcat</code></p>
</blockquote>
<pre><code class="hl language-shell"><span class="hl-meta prompt_"># </span><span class="bash">å®˜ç½‘ä½¿ç”¨å‘½ä»¤</span>
docker run -it --rm -p 8888:8080 tomcat:9.0
</code></pre>
<ol>
<li>nginx çš„æ¡ˆåˆ—æ˜¯å¯åŠ¨åœ¨åå°ï¼Œåœæ­¢äº†å®¹å™¨è¿˜æ˜¯å¯ä»¥æŸ¥åˆ°ã€‚</li>
<li><code>docker run -it --rm</code>:<code>--rm</code>ä¸€èˆ¬ç”¨æ¥æµ‹è¯•ï¼Œç”¨å®Œå°±ä¼šè¢«åˆ é™¤</li>
</ol>
<h2 id="å®¹å™¨æ•°æ®å·">å®¹å™¨æ•°æ®å·<a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#å®¹å™¨æ•°æ®å·"></a></h2>
<blockquote>
<p>Docker å®¹å™¨ä¸­äº§ç”Ÿçš„æ•°æ®ï¼ŒåŒæ­¥åˆ°æœ¬åœ°ã€‚æœ¬åœ°çš„æ•°æ®ä¹Ÿå¯ä»¥åœ¨å®¹å™¨ä¸­æŸ¥çœ‹</p>
</blockquote>
<ol>
<li>å®¹å™¨å’Œä¸»æœºå¯ä»¥æ•°æ®å…±äº«</li>
<li>å®¹å™¨å’Œå®¹å™¨ä¹‹é—´ä¹Ÿå¯ä»¥æ•°æ®å…±äº«</li>
</ol>
<blockquote>
<ul>
<li>windows:<code>docker run -it -v /d/test:/home centos</code>,è·¯å¾„è¦å’Œ linux çš„é£æ ¼ç›¸åŒ</li>
<li>linux: <code>docker run -it -v /home/test:/home centos</code></li>
<li>è§£é‡Šä¸€ä¸‹ linux çš„å§ï¼šå°±æ˜¯å°†<strong>å®¹å™¨ä¸­</strong> <code>/home</code>ç›®å½•ä¸‹çš„æ–‡ä»¶åŒæ­¥åˆ°<strong>ä¸»æœºä¸­</strong>
<code>/home/test</code></li>
</ul>
</blockquote>
<ul>
<li>ä½¿ç”¨<code>docker inspect</code>:æŸ¥çœ‹å®¹å™¨çš„è¯¦ç»†ä¿¡æ¯</li>
</ul>
<pre><code class="hl language-shell"><span class="hl-meta prompt_"># </span><span class="bash">æŒ‚è½½</span>
"Mounts": [
    {
        "Type": "bind",
        "Source": "/d/test", # ä¸»æœºå†…åœ°å€
        "Destination": "/home", # dockerå®¹å™¨çš„åœ°å€
        "Mode": "",
        "RW": true,
        "Propagation": "rprivate"
    }
]
</code></pre>
<blockquote>
<p>å®‰è£… mongoDBï¼Œå®˜ç½‘:<a href="https://hub.docker.com/_/mongo">https://hub.docker.com/_/mongo</a>(mongoDB çš„é…ç½®æ–‡ä»¶å’Œæ•°æ®æ–‡ä»¶éƒ½åœ¨/data ä¸‹é¢)</p>
</blockquote>
<pre><code class="hl language-shell"><span class="hl-meta prompt_"># </span><span class="bash">-v:æ•°æ®å·æŒ‚è½½</span>
<span class="hl-meta prompt_"># </span><span class="bash">-e:è®¾ç½®ç¯å¢ƒé…ç½®</span>
<span class="hl-meta prompt_">
# </span><span class="bash">å®˜æ–¹å®‰è£…</span>
docker run --name some-mongo -v /my/own/datadir:/data/db -d mongo
<span class="hl-meta prompt_">
# </span><span class="bash">è‡ªå·±å°è¯•è¿æ¥</span>
docker run -d -p 27017:27017 -v /g/DBMS/mongo/data:/data -e MONGO_INITDB_ROOT_USERNAME=root -e MONGO_INITDB_ROOT_PASSWORD=123456 mongo
<span class="hl-meta prompt_"># </span><span class="bash">å¯åŠ¨ä¹‹åå¯ä»¥åœ¨æœ¬åœ°ä½¿ç”¨è¿æ¥</span>
</code></pre>
<h3 id="å…·åæŒ‚è½½å’ŒåŒ¿åæŒ‚è½½">å…·åæŒ‚è½½å’ŒåŒ¿åæŒ‚è½½<a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#å…·åæŒ‚è½½å’ŒåŒ¿åæŒ‚è½½"></a></h3>
<ol>
<li><code>docker run -d -P --name nginx01 -v /etc/nginx nginx</code>,ä¸æŒ‡å®šä¸»æœºçš„æ˜ å°„ç›®å½• (åŒ¿åæŒ‚è½½)</li>
<li><code>docker run -d -P --name nginx01 -v test:/etc/nginx nginx</code>,ä¸æŒ‡å®šä¸»æœºçš„æ˜ å°„ç›®å½• (å…·åæŒ‚è½½)</li>
<li>æŸ¥çœ‹æ‰€æœ‰çš„<code>volumn</code>(æŒ‚è½½å·) çš„æƒ…å†µ</li>
</ol>
<pre><code class="hl language-shell">G:\>docker volume ls
DRIVER    VOLUME NAME
local     0c65a12280af5da18c06169e98ceb7493a80082ac39cf5fc5a01263958ede773
local     test
...
</code></pre>
<ul>
<li>å¦‚æœæ˜¯åŒ¿åæŒ‚è½½ï¼Œä¼šè‡ªåŠ¨æ˜ å°„åˆ°<code>"/var/lib/docker/volumes/xxx/_data"</code></li>
</ul>
<blockquote>
<p>ä½¿ç”¨<code>docker volume inspect test</code>å¯ä»¥æŸ¥æ‰¾æŒ‚è½½è·¯å¾„</p>
</blockquote>
<pre><code class="hl language-json"><span class="hl-punctuation">[</span>
 <span class="hl-punctuation">{</span>
   <span class="hl-attr">"CreatedAt"</span><span class="hl-punctuation">:</span> <span class="hl-string">"2022-01-22T10:27:43Z"</span><span class="hl-punctuation">,</span>
   <span class="hl-attr">"Driver"</span><span class="hl-punctuation">:</span> <span class="hl-string">"local"</span><span class="hl-punctuation">,</span>
   <span class="hl-attr">"Labels"</span><span class="hl-punctuation">:</span> <span class="hl-literal"><span class="hl-keyword">null</span></span><span class="hl-punctuation">,</span>
   <span class="hl-attr">"Mountpoint"</span><span class="hl-punctuation">:</span> <span class="hl-string">"/var/lib/docker/volumes/test/_data"</span><span class="hl-punctuation">,</span>
   <span class="hl-attr">"Name"</span><span class="hl-punctuation">:</span> <span class="hl-string">"test"</span><span class="hl-punctuation">,</span>
   <span class="hl-attr">"Options"</span><span class="hl-punctuation">:</span> <span class="hl-literal"><span class="hl-keyword">null</span></span><span class="hl-punctuation">,</span>
   <span class="hl-attr">"Scope"</span><span class="hl-punctuation">:</span> <span class="hl-string">"local"</span>
 <span class="hl-punctuation">}</span>
<span class="hl-punctuation">]</span>
</code></pre>
<blockquote>
<p>é€šè¿‡å…·åæŒ‚è½½å¯ä»¥å¾ˆå®¹æ˜“çš„æ‰¾åˆ°ä¸€ä¸ªå·ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹åœ¨ä½¿ç”¨<code>å…·åæŒ‚è½½</code></p>
</blockquote>
<ol>
<li><code>-v å®¹å™¨å†…è·¯å¾„</code>:åŒ¿åæŒ‚è½½</li>
<li><code>-v å·å:å®¹å™¨å†…è·¯å¾„</code>:å…·åæŒ‚è½½</li>
<li><code>-v /å®¿ä¸»è·¯å¾„:/å®¹å™¨å†…è·¯å¾„</code>:æŒ‡å®šè·¯å¾„æŒ‚è½½</li>
</ol>
<pre><code class="hl language-shell"><span class="hl-meta prompt_"># </span><span class="bash">ro ===><span class="hl-built_in">readonly</span> åªè¯»,åªèƒ½é€šè¿‡å®¿ä¸»æœºæ¥æ“ä½œ,å®¹å™¨å†…éƒ¨æ— æ³•æ“ä½œ</span>
<span class="hl-meta prompt_"># </span><span class="bash">rw ===>readwrite å¯è¯»å¯å†™(é»˜è®¤)</span>
<span class="hl-meta prompt_"># </span><span class="bash">å¦‚æœè®¾ç½®äº†è¿™äº›æƒé™,å®¹å™¨å°±æœ‰é™å®š</span>

docker run -d -P --name nginx01 -v test:/etc/nginx:ro nginx
docker run -d -P --name nginx01 -v test:/etc/nginx:rw nginx
</code></pre>
<h2 id="dockerfile">DockerFile<a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#dockerfile"></a></h2>
<blockquote>
<p>å¾ˆå¤šå®˜æ–¹çš„é•œåƒéƒ½æ˜¯åŸºç¡€åŒ…ã€‚åˆ©ç”¨ dockerfile è‡ªå·±å»æ­å»ºé•œåƒ</p>
</blockquote>
<ul>
<li>æ„å»ºçš„å¤§æ¦‚æµç¨‹
<ol>
<li>ç¼–å†™ä¸€ä¸ª <code>dockerFile</code> æ–‡ä»¶</li>
<li><code>docker build</code>æ„å»ºæˆä¸ºä¸€ä¸ªé•œåƒ</li>
<li><code>docker run</code>è¿è¡Œé•œåƒ</li>
<li><code>docker push</code>å‘å¸ƒé•œåƒ (dockerhub ä»“åº“)</li>
</ol>
</li>
</ul>
<pre><code class="hl language-shell">FROM scratch
ADD centos-8-x86_64.tar.xz /
LABEL org.label-schema.schema-version="1.0"     org.label-schema.name="CentOS Base Image"     org.label-schema.vendor="CentOS"     org.label-schema.license="GPLv2"     org.label-schema.build-date="20210915"
CMD ["/bin/bash"]
</code></pre>
<h3 id="dockerfile-æ„å»º">DockerFile æ„å»º<a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#dockerfile-æ„å»º"></a></h3>
<ol>
<li>æ¯ä¸ªä¿ç•™å…³é”®å­— (æŒ‡ä»¤) éƒ½å¿…é¡»æ˜¯å¤§å†™å­—æ¯</li>
<li>æ‰§è¡Œä»ä¸Šåˆ°ä¸‹çš„é¡ºåº</li>
<li># è¡¨ç¤ºæ³¨é‡Š</li>
<li>æ¯ä¸€ä¸ªæŒ‡ä»¤éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„é•œåƒå±‚å¹¶æäº¤</li>
</ol>
<p><img src="https://media.githubusercontent.com/media/fwqaaq/fwqaaq.github.io/dev/src/picture/dockerFile%E6%9E%84%E5%BB%BA.png" alt="dockerFile æ„å»º"></p>
<ul>
<li><code>DockerFile</code>:æ„å»ºæ–‡ä»¶ï¼Œå®šä¹‰æ­¥éª¤ï¼Œç”Ÿæˆæºä»£ç </li>
<li><code>DockerImages</code>:é€šè¿‡<code>DockerFile</code>æ„å»ºç”Ÿæˆçš„é•œåƒ (æœ€ç»ˆè¿è¡Œå’Œå‘å¸ƒ)</li>
<li><code>Dockerå®¹å™¨</code>:é•œåƒè¿è¡Œèµ·æ¥æä¾›çš„æœåŠ¡å™¨</li>
</ul>
<blockquote>
<p>dockerFile çš„ zhiling</p>
</blockquote>





























































<table><thead><tr><th>FROM</th><th>åŸºç¡€é•œåƒï¼Œæ„å»ºçš„å¼€å§‹</th></tr></thead><tbody><tr><td>MAINTAINER(å·²å¯ç”¨)</td><td>é•œåƒçš„ä½œè€…ï¼Œå§“å + é‚®ç®±</td></tr><tr><td>LABEL</td><td>ä»£æ›¿<code>MAINTAINER</code>,LABEL æŒ‡ä»¤æ·»åŠ å…ƒæ•°æ®åˆ°ä¸€ä¸ªé•œåƒã€‚LABEL æ˜¯ä¸€ä¸ªé”®å€¼å¯¹ (å¯ä»¥æœ‰å¾ˆå¤š)</td></tr><tr><td>RUN</td><td>æ„å»ºçš„æ—¶åˆ»è¿è¡Œçš„å‘½ä»¤</td></tr><tr><td>ADD</td><td>æ­¥éª¤ï¼Œéœ€è¦æ·»åŠ çš„é•œåƒæ–‡ä»¶</td></tr><tr><td>WORKDIR</td><td>é•œåƒçš„å·¥ä½œç›®å½•</td></tr><tr><td>VOLUME</td><td>æŒ‚è½½çš„ç›®å½•</td></tr><tr><td>EXPOSE</td><td>æš´éœ²ç«¯å£ (ä¸æš´éœ²å°±éœ€è¦ç”¨<code>-p</code>)</td></tr><tr><td>CMD</td><td>æŒ‡å®šå®¹å™¨å¯åŠ¨æ—¶å€™è¦è¿è¡Œçš„å‘½ä»¤ï¼Œåªæœ‰æœ€åä¸€ä¸ªä¼šç”Ÿæ•ˆï¼Œå¯è¢« ENTRYPOINT æ›¿ä»£</td></tr><tr><td>ENTRYPOINT</td><td>æŒ‡å®šå®¹å™¨å¯åŠ¨æ—¶å€™è¦è¿è¡Œçš„å‘½ä»¤ï¼Œå¯ä»¥è¿½åŠ å‘½ä»¤</td></tr><tr><td>ONBUILD</td><td>æ„å»ºä¸€ä¸ªè¢«ç»§æ‰¿çš„<code>DockerFile</code>å°±ä¼šè¿è¡Œ<code>ONBUILD</code>æŒ‡ä»¤ï¼Œè§¦å‘æŒ‡ä»¤</td></tr><tr><td>COPY</td><td>ç±»ä¼¼ ADDï¼Œå°†æ–‡ä»¶æ‹·è´åˆ°é•œåƒä¸­</td></tr><tr><td>ENV</td><td>æ„å»ºçš„æ—¶å€™ç”Ÿæˆç¯å¢ƒå˜é‡</td></tr><tr><td>SHELL</td><td>æŒ‡å®š <code>RUN</code>ã€<code>ENTRYPOINT</code>ã€<code>CMD</code> æŒ‡ä»¤çš„ shell</td></tr></tbody></table>
<blockquote>
<p>æ„å»º centos</p>
</blockquote>
<pre><code class="hl language-shell"><span class="hl-meta prompt_"># </span><span class="bash">1.ç¼–å†™DockerFileæ–‡ä»¶</span>
FROM centos
LABEL name="fw" email="fwqaaq@gmail.com"
ENV MYPATH = /usr/local
WORKDIR ${MYPATH} # è¿›å…¥å®¹å™¨ä¹‹åçš„å·¥ä½œç›®å½•
RUN yum -y install vim # æ·»åŠ å·¥å…·
RUN yum -y install net-tools # æ·»åŠ å·¥å…·
EXPOSE 80 # æš´éœ²ç«¯å£
CMD /bin/bash
<span class="hl-meta prompt_"># </span><span class="bash">SHELL [<span class="hl-string">"/bin/sh"</span>, <span class="hl-string">"-c"</span>] linux é»˜è®¤æ˜¯æ­¤å‘½ä»¤</span>
<span class="hl-meta prompt_"># </span><span class="bash">2.é€šè¿‡è¿™ä¸ªæ„å»ºé•œåƒ</span>
<span class="hl-meta prompt_"># </span><span class="bash">å‘½ä»¤ docker build -f (æ„å»ºçš„DockerFileæ–‡ä»¶) -t (è¾“å‡ºçš„é•œåƒå) .</span>

[root@VM-12-17-centos Docker]# docker build -f DockerFile  -t mycentos:0.1 .
<span class="hl-meta prompt_">
# </span><span class="bash">3.æŸ¥çœ‹é•œåƒçš„æ„å»ºè¿‡ç¨‹`docker <span class="hl-built_in">history</span> é•œåƒå`</span>
</code></pre>
<ul>
<li>æ³¨æ„ï¼šå¦‚æœç›´æ¥å°†æ–‡ä»¶å‘½å<code>Dockerfile</code>,é‚£ä¹ˆä¸éœ€è¦åŠ <code>-f</code>docker ä¼šè‡ªåŠ¨å¯»æ‰¾</li>
<li>ä½¿ç”¨<code>ADD</code>æ·»åŠ çš„æ–‡ä»¶ä¼šè‡ªåŠ¨è§£å‹ï¼Œä¾‹å¦‚<code>apache-tomcat-8.5.75.tar.gz</code></li>
</ul>
<blockquote>
<p><code>CMD</code>å’Œ<code>ENTRYPOINT</code>çš„åŒºåˆ«</p>
</blockquote>
<ul>
<li>å¤§éƒ¨åˆ† linux å‘è¡Œç‰ˆçš„åŸºç¡€é•œåƒé‡Œé¢è°ƒç”¨ CMD å‘½åï¼ŒæŒ‡å®šå®¹å™¨å¯åŠ¨åç›´æ¥æ‰§è¡Œ<code>/bin/bash</code>æˆ–è€…<code>/bin/sh</code>,è¿™æ ·é•œåƒå°±ä¼šé»˜è®¤è¿›å…¥äº¤äº’çš„<code>shell</code></li>
</ul>
<pre><code class="hl language-shell">FROM centos
...
CMD "/bin/bash"
</code></pre>
<ul>
<li>
<p>CMD ç»™å‡ºçš„æ˜¯ä¸€ä¸ªå®¹å™¨çš„é»˜è®¤å¯æ‰§è¡Œä½“ï¼Œä¹Ÿå°±æ˜¯å®¹å™¨å¯åŠ¨ä»¥åï¼Œé»˜è®¤çš„æ‰§è¡Œå‘½åã€‚</p>
</li>
<li>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœ docker
run æ²¡æœ‰æŒ‡å®šçš„ä»»ä½•çš„æ‰§è¡Œå‘½åæˆ–è€… dockfile é‡Œé¢ä¹Ÿæ²¡æœ‰ entrypointï¼Œé‚£ä¹ˆå°±ä¼šæ‰§è¡Œ cmd æŒ‡å®šçš„é»˜è®¤çš„æ‰§è¡Œå‘½åæ‰§è¡Œ</p>
</li>
<li>
<p>æœ‰ä¸‰ç§ç”¨æ³•ï¼š</p>
<ol>
<li>
<p>shell æ ¼å¼çš„å½¢å¼ï¼šä¾‹å¦‚<code>npm install</code>.å‘½ä»¤é»˜è®¤æ˜¯åœ¨<code>/bin/sh -c</code>ä¸‹æ‰§è¡Œçš„ã€‚</p>
<pre><code class="hl language-txt">FROM centos
...
CMD echo "hello"
</code></pre>
<ul>
<li>å½“æˆ‘ä»¬è¿è¡Œ<code>docker run...</code>çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨<code>/bin/bsah</code>ç„¶åæ‰“å°å‡º<code>hello</code></li>
</ul>
</li>
<li>
<p>exec æ ¼å¼çš„å½¢å¼ (æ¨èä½¿ç”¨):ä¾‹å¦‚<code>["npm","install"]</code>.å¹¶ä¸”ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯å…¨è·¯å¾„ï¼Œå¹¶ä¸”ä¸€ä¸ª<code>dockerfile</code>åªèƒ½æœ‰ä¸€ä¸ª cmdï¼Œå¦‚æœæœ‰å¤šä¸ªï¼Œåˆ™æŒ‡ä¼šåæœ€åä¸€ä¸ªç”Ÿæ•ˆã€‚</p>
<ul>
<li>ä¸Šé¢çš„æ–¹å¼æ”¹å†™ï¼š<code>["/bin/bash","-c","echo","hello"]</code></li>
<li>å¦‚æœæˆ‘ä»¬åœ¨ run çš„æ—¶å€™æŒ‡å®šäº†å‘½ä»¤æˆ–è€…æœ‰ entrypointï¼Œé‚£ä¹ˆ cmd å°±ä¼šè¢«è¦†ç›–
<ul>
<li><code>docker run ... echo "world"</code>,é‚£ä¹ˆæ§åˆ¶å°å°±ä¼šæ‰“å°<code>world</code>,è€Œä¸æ˜¯é»˜è®¤çš„ hello</li>
</ul>
</li>
</ul>
</li>
</ol>
</li>
<li>
<p><code>ENTRYPOINT</code>é»˜è®¤æ˜¯åœ¨ shell ç¯å¢ƒä¸‹æ‰§è¡Œçš„ï¼Œä¸ CMD æœ‰åŒºåˆ«ã€‚</p>
<ul>
<li>å¦‚æœ run å‘½ååæœ‰ä¸œè¥¿ï¼Œé‚£ä¹ˆå…¨éƒ¨ä¼šä½œä¸º<code>entrypoint</code>çš„å‚æ•°ã€‚</li>
<li>å¦‚æœ run åé¢æ²¡æœ‰ä¸œè¥¿ï¼Œä½†æ˜¯ CMD æœ‰ï¼Œé‚£ä¹ˆ CMD çš„å…¨éƒ¨å†…å®¹ä¼šä½œä¸º entrypoint çš„å‚æ•°ï¼Œè¿™åŒæ—¶æ˜¯ cmd çš„ç¬¬ä¸‰ç§ç”¨æ³•</li>
</ul>
</li>
<li>
<p>exec å½¢å¼ï¼šå°† CMD å½“ä½œé»˜è®¤çš„å‚æ•°</p>
<pre><code class="hl language-txt">FROM centeos
...
CMD ["hello"]
ENTRYPOINT ["echo","hello"]
</code></pre>
<ul>
<li>å¦‚æœè¿è¡Œ<code>doecker run ...</code>,ä¼šç›´æ¥æ‰“å°<code>hello hello</code></li>
<li>å¦‚æœè¿è¡Œ<code>docker run ... world</code>,é‚£ä¹ˆ cmd å°±ä¼šè¢«è¦†ç›–ï¼Œæ‰“å°<code>hello world</code></li>
</ul>
</li>
<li>
<p>å¦‚æœä½¿ç”¨ shell æ¨¡å¼:shell çš„å½¢å¼ä¼šä½¿<code>ENTRYPOINT</code>å¿½ç•¥ä»»ä½• CMD æˆ–è€… docker è¿è¡Œçš„å‘½ä»¤è¡Œå‚æ•°</p>
</li>
<li>
<p>å¦‚æœéœ€è¦æä¾›é»˜è®¤çš„å‘½ä»¤æˆ–åœ¨ docker å®¹å™¨è¿è¡Œæ—¶å¯ä»¥ä»å‘½ä»¤è¡Œè¦†ç›–çš„å‚æ•°æ—¶ï¼Œä½¿ç”¨<code>CMD</code></p>
</li>
<li>
<p>æœ€å¥½çš„é€‰æ‹©æ˜¯ä½¿ç”¨<code>exec</code>,è€Œä¸æ˜¯ shell å‘½ä»¤</p>
</li>
</ul>
<h3 id="ä¸Šä¸‹æ–‡">ä¸Šä¸‹æ–‡<a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#ä¸Šä¸‹æ–‡"></a></h3>
<pre><code class="hl language-bash">docker build -t nginx:v3 .
</code></pre>
<ul>
<li>é€šå¸¸æœ€åçš„è·¯å¾„å°±æ˜¯æŒ‡å®šçš„ä¸Šä¸‹æ–‡ï¼Œå¹¶ä¸æ˜¯ Dockerfile æ–‡ä»¶æ‰€åœ¨çš„ä½ç½®ï¼Œè€Œæ˜¯æ‰“åŒ…
Dockerfile æ–‡ä»¶å†…å®¹ä¸­çš„ä½ç½®</li>
<li>ç±»ä¼¼äº <code>.</code> è¿™æ ·çš„ï¼Œå°±æ˜¯ docker build æ‰€æ‰§è¡Œçš„ä½ç½®ä¸ºè·¯å¾„æ‰“åŒ…</li>
</ul>
<pre><code class="hl language-txt">COPY ./package.json /app/
</code></pre>
<ul>
<li>å¦‚æœéœ€è¦æŒ‡å®š Dockerfile ä½ç½®ï¼Œ<code>-f ../Dockerfile</code>ï¼Œå½“ç„¶å®ƒä¹Ÿå¯ä»¥æ˜¯åˆ«çš„åç§°</li>
</ul>
<h3 id="onbuild">ONBUILD<a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#onbuild"></a></h3>
<blockquote>
<p>å°†é¡¹ç›®ç›¸å…³çš„æŒ‡ä»¤åŠ ä¸Š ONBUILDï¼Œè¿™æ ·åœ¨æ„å»ºåŸºç¡€é•œåƒçš„æ—¶å€™ï¼Œè¿™ä¸‰è¡Œå¹¶ä¸ä¼šè¢«æ‰§è¡Œ</p>
</blockquote>
<pre><code class="hl language-txt">FROM node:slim
RUN mkdir /app
WORKDIR /app
ONBUILD COPY ./package.json /app
ONBUILD RUN [ "npm", "install" ]
ONBUILD COPY . /app/
CMD [ "npm", "start" ]
</code></pre>
<blockquote>
<p>ç„¶åå„ä¸ªé¡¹ç›®çš„ Dockerfile å°±å˜æˆäº†ç®€å•åœ°ï¼š</p>
</blockquote>
<pre><code class="hl language-txt">FROM my-node
</code></pre>
<h3 id="æ„å»º-dokerfile">æ„å»º Dokerfile<a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#æ„å»º-dokerfile"></a></h3>
<blockquote>
<p>Dockerfile ä¸­æ¯ä¸€ä¸ªæŒ‡ä»¤éƒ½ä¼šå»ºç«‹ä¸€å±‚ï¼ŒRUN
ä¹Ÿä¸ä¾‹å¤–ã€‚æ‰€ä»¥æˆ‘ä»¬å°½é‡åœ¨ä¸€å±‚åšæ¯ä¸€å±‚è¯¥åšçš„äº‹ï¼Œå¹¶ä¸”ä¸€å®šè¦ç¡®ä¿æ¯ä¸€å±‚åªæ·»åŠ çœŸæ­£éœ€è¦æ·»åŠ çš„ä¸œè¥¿ï¼Œä»»ä½•æ— å…³çš„ä¸œè¥¿éƒ½åº”è¯¥æ¸…ç†æ‰</p>
</blockquote>
<ul>
<li>ä¸è¦å¿˜è®°æ¯ä¸€å±‚æ„å»ºçš„æœ€åä¸€å®šè¦æ¸…ç†æ‰æ— å…³æ–‡ä»¶</li>
</ul>
<pre><code class="hl language-txt">FROM debian:stretch

RUN set -x; buildDeps='gcc libc6-dev make wget' \
    &#x26;&#x26; apt-get update \
    &#x26;&#x26; apt-get install -y $buildDeps \
    &#x26;&#x26; wget -O redis.tar.gz "http://download.redis.io/releases/redis-5.0.3.tar.gz" \
    &#x26;&#x26; mkdir -p /usr/src/redis \
    &#x26;&#x26; tar -xzf redis.tar.gz -C /usr/src/redis --strip-components=1 \
    &#x26;&#x26; make -C /usr/src/redis \
    &#x26;&#x26; make -C /usr/src/redis install \
    &#x26;&#x26; rm -rf /var/lib/apt/lists/* \
    &#x26;&#x26; rm redis.tar.gz \
    &#x26;&#x26; rm -r /usr/src/redis \
    &#x26;&#x26; apt-get purge -y --auto-remove $buildDeps
</code></pre>
<blockquote>
<p>å®¹å™¨æ„å»ºæ—¶ï¼Œæˆ‘ä»¬ä¸èƒ½å°†å®ƒç®€å•çš„ä½¿ç”¨ systemctl æˆ–è€… service
è¿™ç±»å®ˆæŠ¤è¿›ç¨‹åå°è¿è¡Œã€‚</p>
</blockquote>
<p>å¯¹äºå®¹å™¨è€Œè¨€ï¼Œå…¶å¯åŠ¨ç¨‹åºå°±æ˜¯å®¹å™¨åº”ç”¨è¿›ç¨‹ï¼Œå®¹å™¨å°±æ˜¯ä¸ºäº†ä¸»è¿›ç¨‹è€Œå­˜åœ¨çš„ï¼Œä¸»è¿›ç¨‹é€€å‡ºï¼Œå®¹å™¨å°±å¤±å»äº†å­˜åœ¨çš„æ„ä¹‰</p>
<p>æ‰€ä»¥æ­£ç¡®çš„åšæ³•æ˜¯åœ¨å‰å°æ‰§è¡Œå¯æ‰§è¡Œæ–‡ä»¶</p>
<pre><code class="hl language-txt">CMD ["nginx", "-g", "daemon off;"]
</code></pre>
<h2 id="å‘å¸ƒé•œåƒ">å‘å¸ƒé•œåƒ<a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#å‘å¸ƒé•œåƒ"></a></h2>
<blockquote>
<p>å‘å¸ƒåˆ° Dockerhub</p>
</blockquote>
<ol>
<li>
<p>ç™»å½•è´¦å·<code>docker login -u (user) -p (password)</code></p>
</li>
<li>
<p>ç»™ images æ‰“ä¸€ä¸ªæ ‡ç­¾ (/ä¹‹å‰çš„å¾—æ˜¯ docker ç”¨æˆ·åæ‰èƒ½ä¸Šä¼ æˆåŠŸ)</p>
<ul>
<li><code>denied: requested access to the resource is denied</code>:(å¯èƒ½ç”¨æˆ·åä¸å¯¹)</li>
</ul>
<pre><code class="hl language-shell">docker tag divtomcat fw1314/divtomcat:v0.0.1
</code></pre>
</li>
<li>
<p>ä¸Šä¼ åˆ°è¿œç¨‹ä»“åº“<code>docker push fw1314/divtomcat:v0.0.1</code></p>
<ul>
<li>æäº¤çš„æ—¶å€™ä¹Ÿæ˜¯æŒ‰å±‚çº§æäº¤</li>
</ul>
</li>
</ol>
<blockquote>
<p><a href="https://cr.console.aliyun.com/cn-hangzhou/instances">å‘å¸ƒåˆ°é˜¿é‡Œäº‘å®¹å™¨</a></p>
</blockquote>
<ol>
<li>åœ¨é˜¿é‡Œäº‘å®¹å™¨æœåŠ¡ä¸­åˆ›å»ºä¸ªäººå®ä¾‹</li>
<li>åˆ›å»ºå‘½åç©ºé—´</li>
<li>åˆ›å»ºå®¹å™¨é•œåƒ (é€‰æ‹©æœ¬åœ°)</li>
<li>å‚è€ƒ<code>åŸºæœ¬ä¿¡æ¯</code></li>
</ol>
<blockquote>
<p>é•œåƒçš„å¯¼å…¥å¯¼å‡º</p>
</blockquote>
<ol>
<li><code>docker save</code>:å°†ä¸€ä¸ªæˆ–å¤šä¸ª<strong>image</strong>æ‰“åŒ…ä¿å­˜çš„å·¥å…·
<ul>
<li>å®˜æ–¹ï¼š<code>Usage:docker save [OPTIONS] IMAGE [IMAGE...]</code></li>
<li>ä¾‹å¦‚<code>docker save -o images.tar postgres:9.6 mongo:3.4</code>:å°†é•œåƒåº“ä¸­çš„ postgres å’Œ mongo æ‰“åŒ…</li>
</ul>
</li>
<li><code>docker load</code>:å°†æ‰“åŒ…åçš„é•œåƒè½½å…¥è¿›æ¥
<ul>
<li>å®˜æ–¹ï¼š<code>Usage:  docker load [OPTIONS]</code></li>
<li>ä¾‹å¦‚ï¼š<code>docker load -i images.tar</code>æŠŠ postgres:9.6 å’Œ mongo:3.4 è½½å…¥è¿›æ¥ï¼Œå¦‚æœæœ¬åœ°é•œåƒåº“å·²ç»å­˜åœ¨è¿™ä¸¤ä¸ªé•œåƒï¼Œå°†ä¼šè¢«è¦†ç›–</li>
</ul>
</li>
</ol>
<blockquote>
<p>å®¹å™¨çš„å¿«ç…§</p>
</blockquote>
<ol>
<li><code>docker export</code>:å°† container çš„æ–‡ä»¶ç³»ç»Ÿè¿›è¡Œæ‰“åŒ… (åªä¿å­˜å½“æ—¶çš„å¿«ç…§)
<ul>
<li>å®˜æ–¹ï¼š<code>Usage:docker export [OPTIONS] CONTAINER</code></li>
<li>ä¾‹å¦‚ï¼š<code>docker export -o postgres-export.tar postgres(æŒ‡å®šçš„å®¹å™¨)</code>å°†æ­£åœ¨æ‰§è¡Œçš„ postgres å®¹å™¨æ‰“åŒ…</li>
</ul>
</li>
<li><code>docker import</code>
<ul>
<li>å®˜æ–¹ï¼š<code>docker import [OPTIONS] file|URL|- [REPOSITORY[:TAG]]</code>:å¯ä»¥æŒ‡å®šè·¯å¾„å’Œé‡æ–°å‘½å</li>
<li>ä¾‹å¦‚ï¼š<code>docker import postgres-export.tar postgres:latest</code>å¯¼å…¥åä¼šæˆä¸ºä¸€ä¸ª<code>image</code>(ä¸ä¼šå¯¼å‡ºå®¹å™¨)</li>
</ul>
</li>
</ol>
<blockquote>
<p>åŒºåˆ«</p>
</blockquote>
<ol>
<li><code>docker save</code>ä¿å­˜çš„æ˜¯é•œåƒ (image),<code>docker export</code>ä¿å­˜çš„æ˜¯å®¹å™¨ (container)</li>
<li><code>docker load</code>ç”¨æ¥è½½å…¥é•œåƒåŒ…ï¼Œ<code>docker import</code>ç”¨æ¥è½½å…¥å®¹å™¨åŒ…ï¼Œä½†ä¸¤è€…éƒ½ä¼šæ¢å¤ä¸ºé•œåƒ</li>
<li><code>docker load</code>ä¸èƒ½å¯¹è½½å…¥çš„é•œåƒé‡å‘½åï¼Œè€Œ<code>docker import</code>å¯ä»¥ä¸ºé•œåƒæŒ‡å®šæ–°åç§°</li>
</ol>
<blockquote>
<p>å‚è€ƒ:<a href="https://jingsam.github.io/2017/08/26/docker-save-and-docker-export.html">https://jingsam.github.io/2017/08/26/docker-save-and-docker-export.html</a></p>
</blockquote>
<h2 id="docker-ç½‘ç»œ">Docker ç½‘ç»œ<a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#docker-ç½‘ç»œ"></a></h2>
<ul>
<li>é¦–å…ˆæŸ¥çœ‹æœåŠ¡å™¨çš„ç½‘ç»œ<code>ifconfig</code>,æ˜¾ç¤ºä¸‰ä¸ªç½‘ç»œ
<ol>
<li><code>docker0</code>:docker è‡ªå·±ç”Ÿæˆçš„åœ°å€</li>
<li><code>eth0</code>:æœåŠ¡å™¨çš„å†…ç½‘åœ°å€</li>
<li><code>lo</code>:æœ¬åœ°å›ç¯åœ°å€</li>
</ol>
</li>
<li>å¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼Œä¾‹å¦‚ tomcat</li>
</ul>
<pre><code class="hl language-shell">[root@VM-12-17-centos /]# docker run -d -P --name tomcat01 tomcat
</code></pre>
<ul>
<li>å‘ç°æ²¡æœ‰<code>ip addr</code>å‘½ä»¤ï¼Œè¿›å…¥å®¹å™¨<code>docker exec -it tomcat01 /bin/bash</code></li>
<li>ä¸‹è½½<code>apt update &#x26;&#x26; apt install -y iproute2</code></li>
<li>æŸ¥çœ‹å®¹å™¨å†…éƒ¨çš„ç½‘å€ç»“æ„<code>docker exec -it tomcat01 ip addr</code></li>
</ul>
<pre><code class="hl language-shell">1: lo: &#x3C;LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
8: eth0@if9: &#x3C;BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default 
    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0
    inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0
       valid_lft forever preferred_lft forever
</code></pre>
<ul>
<li><code>ping 172.17.0.2</code>:å®¿ä¸»æœºå¯ä»¥ ping é€šå®¹å™¨</li>
</ul>
<blockquote>
<p>åŸç†</p>
</blockquote>
<ol>
<li>
<p>å½“æˆ‘ä»¬å¯åŠ¨ä¸€ä¸ªå®¹å™¨çš„æ—¶å€™ï¼Œdocker å°±ä¼šç»™æˆ‘ä»¬åˆ†é…ä¸€ä¸ª ipï¼Œåªè¦å®‰è£… dockerï¼Œå°±ä¼šæœ‰ä¸€ä¸ªç½‘å¡<code>docker0</code></p>
</li>
<li>
<p>ç½‘å¡ä½¿ç”¨çš„æ˜¯æ¡¥æ¥æ¨¡å¼</p>
</li>
<li>
<p>å½“æˆ‘ä»¬å†æ¬¡<code>ifconfig</code></p>
<pre><code class="hl language-shell"><span class="hl-meta prompt_"># </span><span class="bash">å¤šå‡ºæ¥çš„ç½‘ç»œ</span>
9: veth9c8db14@if8: &#x3C;BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master docker0 state UP group default 
   link/ether a2:d2:1c:d0:7f:6a brd ff:ff:ff:ff:ff:ff link-netnsid 0
   inet6 fe80::a0d2:1cff:fed0:7f6a/64 scope link 
      valid_lft forever preferred_lft forever
</code></pre>
<blockquote>
<p>å¤šå‡ºæ¥çš„ç½‘å¡æ˜¯æŒ‰å¯¹å‡ºç°çš„ã€‚<code>evth-pair</code>ä¸€æ®µè¿ç€åè®®ï¼Œä¸€æ®µå½¼æ­¤ç›¸è¿ã€‚<code>evth-pair</code>å……å½“ä¸€ä¸ªæ¡¥æ¢ï¼Œå½¼æ­¤ç›¸è¿</p>
</blockquote>
</li>
<li>
<p>æ²¡æœ‰ ping åŒ…ã€‚ä¸‹è½½ï¼š<code>apt install iputils-ping</code></p>
</li>
<li>
<p>å†å¯åŠ¨ä¸€ä¸ª tomcat,<code>tomcat01</code>ping<code>tomcat02</code>(å‘ç°å¯ä»¥ ping é€š)</p>
</li>
</ol>
<p><img src="https://media.githubusercontent.com/media/fwqaaq/fwqaaq.github.io/dev/src/picture/docker%E7%BD%91%E7%BB%9C.png" alt="docker ç½‘ç»œ"></p>
<ol>
<li>tomcat01 å’Œ tomcat02 æ˜¯å…¬ç”¨çš„ä¸€ä¸ªè·¯ç”±å™¨ (<code>docker0</code>)</li>
<li>æ‰€æœ‰çš„å®¹å™¨å†ä¸æŒ‡å®šç½‘ç»œçš„æƒ…å†µä¸‹ï¼Œéƒ½æ˜¯ docker0 è½¬å‘çš„ï¼Œdocker ä¼šç»™æ‰€æœ‰å®¹å™¨åˆ†é…ä¸€ä¸ªé»˜è®¤å¯ç”¨çš„ ip</li>
<li>Docker ä½¿ç”¨çš„æ˜¯ Linux ç½‘æ¡¥ï¼Œå®¿ä¸»æœºä¸­æ˜¯ä¸€ä¸ª Docker å®¹å™¨çš„ç½‘æ¡¥ docker0</li>
<li>Docker ä¸­çš„æ‰€æœ‰ç½‘ç»œæ¥å£éƒ½æ˜¯è™šæ‹Ÿçš„ (å†…ç½‘ç©¿é€)</li>
<li>åªè¦åˆ é™¤å®¹å™¨ï¼Œå…¶ä¸­çš„ä¸€å¯¹ç½‘æ¡¥å°±æ¶ˆå¤±</li>
</ol>
<h3 id="--link">--link<a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#--link"></a></h3>
<ol>
<li>åˆ›å»ºä¸€ä¸ª<code>centos01</code>é•œåƒ<code>docker run -it --name centos01 centos</code></li>
<li>å…³è”åˆ›å»ºçš„<code>centos02</code>:<code>docker run -it --name centos02 --link centos01 centos</code>
<ol>
<li>åœ¨<code>centos02</code>ä¸­<code>ping centos01</code>å®Œå…¨å¯ä»¥ ping é€š</li>
<li>åœ¨<code>centos01</code>ä¸­<code>ping centos02</code>ä¸å¯ä»¥ ping é€š<code>ping: centos02: Name or service not known</code></li>
</ol>
</li>
</ol>
<ul>
<li>ä½¿ç”¨<code>docker inspect centos02</code>æŸ¥çœ‹ host é…ç½®</li>
</ul>
<pre><code class="hl language-JSON"><span class="hl-attr">"HostConfig"</span><span class="hl-punctuation">:</span><span class="hl-punctuation">{</span>
   <span class="hl-attr">"Links"</span><span class="hl-punctuation">:</span> <span class="hl-punctuation">[</span>
     <span class="hl-string">"/centos01:/centos02/centos01"</span>
   <span class="hl-punctuation">]</span><span class="hl-punctuation">,</span>
<span class="hl-punctuation">}</span>
</code></pre>
<blockquote>
<ul>
<li>è¿›å…¥<code>centos02</code>åæŸ¥çœ‹ host æ–‡ä»¶ (<code>cat /etc/hosts</code>),å‘ç°--link å°±æ˜¯åœ¨ hosts é…ç½®ä¸­åŠ äº†<code>172.17.0.2 centos01 2147d9e02181</code></li>
<li>ç°åœ¨å·²ç»ä¸å»ºè®®ä½¿ç”¨**--link**</li>
</ul>
</blockquote>
<pre><code class="hl language-shell">127.0.0.1       localhost
::1     localhost ip6-localhost ip6-loopback
fe00::0 ip6-localnet
ff00::0 ip6-mcastprefix
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters
172.17.0.2      centos01 2147d9e02181
172.17.0.3      5561fc170ce7
</code></pre>
<h3 id="è‡ªå®šä¹‰ç½‘ç»œ">è‡ªå®šä¹‰ç½‘ç»œ<a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#è‡ªå®šä¹‰ç½‘ç»œ"></a></h3>
<blockquote>
<p>æŸ¥çœ‹æ‰€æœ‰çš„ docker ç½‘ç»œ<code>docker network ls</code></p>
</blockquote>
<pre><code class="hl language-shell">NETWORK ID     NAME      DRIVER    SCOPE
e8372c51dd7f   bridge    bridge    local
39fabbb25f72   host      host      local
dad25aaf302a   none      null      local
</code></pre>
<blockquote>
<p>ç½‘ç»œæ¨¡å¼ (å¦‚æœè‡ªå·±åˆ›å»ºä¹Ÿä¼šä½¿ç”¨æ¡¥æ¥æ¨¡å¼)</p>
</blockquote>
<ol>
<li><code>bridge</code>:æ¡¥æ¥æ¨¡å¼ (docker é»˜è®¤)</li>
<li><code>none</code>:ä¸é…ç½®ç½‘ç»œ</li>
<li><code>host</code>:å’Œä¸»æœºå…±äº«ç½‘ç»œ</li>
<li><code>container</code>:å®¹å™¨ç½‘ç»œè”é€š (ç°åœ¨å‡ ä¹ä¸ç”¨ï¼Œå±€é™å¾ˆå¤§)~~</li>
</ol>
<blockquote>
<p>æµ‹è¯•</p>
</blockquote>
<ol>
<li>
<p>ç›´æ¥å¯åŠ¨çš„å‘½ä»¤ä¸­ä¼šæœ‰ä¸€ä¸ªé»˜è®¤çš„å‚æ•°<code>--net bridge</code>,è¿™ä¸ªæŒ‡ä»£çš„å°±æ˜¯ docker0</p>
<ul>
<li><code>docker run -d --name tomcat01 (--net bridge) centos</code></li>
</ul>
</li>
<li>
<p><code>docker0</code>çš„ç‰¹ç‚¹ï¼šé»˜è®¤ï¼ŒåŸŸåä¸èƒ½è®¿é—®ï¼Œ--link å¯ä»¥æ‰“é€š</p>
</li>
<li>
<p>è‡ªå®šä¹‰ä¸€ä¸ªç½‘ç»œ</p>
<pre><code class="hl language-shell">docker network create --driver bridge --subnet 192.168.0.0/16 --gateway 192.168.0.1 mynet
<span class="hl-meta prompt_"># </span><span class="bash">subnet æ˜¯å­ç½‘æ©ç </span>
<span class="hl-meta prompt_"># </span><span class="bash">gateway æ˜¯ç½‘å…³</span>
</code></pre>
</li>
<li>
<p>ä½¿ç”¨<code>docker network inspect mynet</code>å¯ä»¥æŸ¥çœ‹è‡ªå®šä¹‰ç½‘ç»œçš„ä¿¡æ¯</p>
</li>
<li>
<p>è‡ªå®šä¹‰çš„ç½‘ç»œéå¸¸çš„å®Œå–„ (ä¸ä½¿ç”¨--link ä¹Ÿå¯ä»¥äº’ç›¸ ping é€š)</p>
</li>
</ol>
<pre><code class="hl language-shell">docker run -it --name centos01 --net mynet centos
docker run -it --name centos02 --net mynet centos
</code></pre>
<ul>
<li>è‡ªå®šä¹‰çš„ç½‘ç»œå·²ç»å¸®æˆ‘ä»¬ç»´æŠ¤å¯¹åº”çš„å…³ç³»ï¼Œè€Œ<code>doker0</code>éœ€è¦<code>--link</code>æ¨èä½¿ç”¨ã€‚ä¿è¯ä¸åŒçš„é›†ç¾¤ä½¿ç”¨ä¸åŒçš„ç½‘ç»œï¼Œä¿è¯é›†ç¾¤æ˜¯å®‰å…¨çš„</li>
</ul>
<h3 id="ç½‘ç»œè¿é€š">ç½‘ç»œè¿é€š<a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#ç½‘ç»œè¿é€š"></a></h3>
<p><img src="https://media.githubusercontent.com/media/fwqaaq/fwqaaq.github.io/dev/src/picture/%E7%BD%91%E7%BB%9C%E8%BF%9E%E9%80%9A.png" alt="docker ç½‘ç»œè¿é€š"></p>
<blockquote>
<p>å°† tomcat åŠ å…¥åˆ° mynet ç½‘ç»œä¸­<code>docker network connect mynet tomcat01</code></p>
</blockquote>
<ul>
<li>ä½¿ç”¨<code>docker network connect mynet tomcat01</code>æŸ¥çœ‹ä¼šå‘ç°åœ¨ mynet ç½‘ç»œä¸­çš„ Containers åŠ å…¥äº† tomcat01</li>
</ul>
<pre><code class="hl language-json"><span class="hl-attr">"Containers"</span><span class="hl-punctuation">:</span> <span class="hl-punctuation">{</span>
    <span class="hl-attr">"3f575a99cc32404f226d6d56cdf28be3c52c7611ae334f19297a1069b1ac9d28"</span><span class="hl-punctuation">:</span> <span class="hl-punctuation">{</span>
        <span class="hl-attr">"Name"</span><span class="hl-punctuation">:</span> <span class="hl-string">"tomcat01"</span><span class="hl-punctuation">,</span>
        <span class="hl-attr">"EndpointID"</span><span class="hl-punctuation">:</span> <span class="hl-string">"6e780a6c3a680ca28c9df28b1eb14fb5fc7470e72df27d8a7444b38e1b5a0a9b"</span><span class="hl-punctuation">,</span>
        <span class="hl-attr">"MacAddress"</span><span class="hl-punctuation">:</span> <span class="hl-string">"02:42:c0:a8:00:02"</span><span class="hl-punctuation">,</span>
        <span class="hl-attr">"IPv4Address"</span><span class="hl-punctuation">:</span> <span class="hl-string">"192.168.0.2/16"</span><span class="hl-punctuation">,</span>
        <span class="hl-attr">"IPv6Address"</span><span class="hl-punctuation">:</span> <span class="hl-string">""</span>
    <span class="hl-punctuation">}</span>
<span class="hl-punctuation">}</span>
</code></pre>
<ul>
<li>åœ¨ tomcat01 ä¸­å¯ä»¥ ping é€š mynet ç½‘ä¸­çš„ä»»æ„ä¸€ä¸ªå®¹å™¨</li>
</ul>
<h2 id="docker-compose"><a href="https://docs.docker.com/compose/">Docker Compose</a><a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#docker-compose"></a></h2>
<blockquote>
<p>Compose é€‚ç”¨äºæ‰€æœ‰ç¯å¢ƒï¼šç”Ÿäº§ã€ç™»å°ã€å¼€å‘ã€æµ‹è¯•ä»¥åŠ CI
å·¥ä½œæµç¨‹ã€‚æ‚¨å¯ä»¥åœ¨å¸¸è§ç”¨ä¾‹ä¸­äº†è§£æœ‰å…³æ¯ä¸ªæ¡ˆä¾‹çš„æ›´å¤šä¿¡æ¯ã€‚</p>
</blockquote>
<ul>
<li>
<p>ä½¿ç”¨ Compose åŸºæœ¬ä¸Šæ˜¯ä¸€ä¸ªä¸‰æ­¥è¿‡ç¨‹ï¼š</p>
<ol>
<li>å®šä¹‰æ‚¨çš„åº”ç”¨ç¨‹åºçš„ç¯å¢ƒï¼ŒDockerfile ä»¥ä¾¿å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹å¤åˆ¶å®ƒã€‚</li>
<li>å®šä¹‰æ„æˆæ‚¨çš„åº”ç”¨ç¨‹åºçš„æœåŠ¡ï¼Œ<code>docker-compose.yml</code>
ä»¥ä¾¿å®ƒä»¬å¯ä»¥åœ¨éš”ç¦»ç¯å¢ƒä¸­ä¸€èµ·è¿è¡Œã€‚</li>
<li>è¿è¡Œ<code>docker compose up</code>ï¼ŒDocker compose
å‘½ä»¤**å¯åŠ¨å¹¶è¿è¡Œæ‚¨çš„æ•´ä¸ªåº”ç”¨ç¨‹åºã€‚docker-compose
up ä¹Ÿå¯ä»¥ä½¿ç”¨äºŒè¿›åˆ¶<code>docker-compose</code>æ–‡ä»¶è¿è¡Œã€‚</li>
</ol>
</li>
<li>
<p><code>docker-compose.yml</code>çœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p>
</li>
</ul>
<pre><code class="hl language-yml"><span class="hl-attr">version:</span> <span class="hl-string">"3.9"</span>  <span class="hl-comment"># optional since v1.27.0</span>
<span class="hl-attr">services:</span>
  <span class="hl-attr">web:</span>
    <span class="hl-attr">build:</span> <span class="hl-string">.</span>
    <span class="hl-attr">ports:</span>
      <span class="hl-bullet">-</span> <span class="hl-string">"5000:5000"</span>
    <span class="hl-attr">volumes:</span>
      <span class="hl-bullet">-</span> <span class="hl-string">.:/code</span>
      <span class="hl-bullet">-</span> <span class="hl-string">logvolume01:/var/log</span>
    <span class="hl-attr">links:</span>
      <span class="hl-bullet">-</span> <span class="hl-string">redis</span>
  <span class="hl-attr">redis:</span>
    <span class="hl-attr">image:</span> <span class="hl-string">redis</span>
<span class="hl-attr">volumes:</span>
  <span class="hl-attr">logvolume01:</span> {}
</code></pre>
<h3 id="å®‰è£…">å®‰è£…<a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#å®‰è£…"></a></h3>
<blockquote>
<p>windows</p>
</blockquote>
<ul>
<li>Docker Desktop for Windows åŒ…æ‹¬ Compose ä»¥åŠå…¶ä»– Docker åº”ç”¨ç¨‹åºï¼Œå› æ­¤å¤§å¤šæ•°
Windows ç”¨æˆ·ä¸éœ€è¦å•ç‹¬å®‰è£… Compose</li>
</ul>
<blockquote>
<p>Linux</p>
</blockquote>
<pre><code class="hl language-shell"><span class="hl-meta prompt_"># </span><span class="bash">ä½¿ç”¨å›½å†…çš„åœ°å€</span>
curl -L "https://get.daocloud.io/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
</code></pre>
<ul>
<li>å¯¹äºŒè¿›åˆ¶æ–‡ä»¶åº”ç”¨å¯æ‰§è¡Œæƒé™ï¼š<code>chmod +x /usr/local/bin/docker-compose</code></li>
<li>æµ‹è¯•å®‰è£…<code>docker-compose --version</code></li>
</ul>
<blockquote>
<p>å®˜ç½‘çš„æµç¨‹</p>
</blockquote>
<ol>
<li>ä¸€ä¸ªåº”ç”¨<code>app.py</code></li>
<li><code>Dockerfile</code>åº”ç”¨æ‰“åŒ…ä¸ºé•œåƒ</li>
<li><code>Docker-compose.yaml</code>æ–‡ä»¶ï¼šå®šä¹‰æ•´ä¸ªæœåŠ¡éœ€è¦çš„ç¯å¢ƒ.web,redis.å®Œæ•´çš„ä¸Šçº¿æœåŠ¡</li>
<li>å¯åŠ¨<code>docker-compose up</code></li>
</ol>
<pre><code class="hl language-shell">Creating composetest_web_1   ... done
Creating composetest_redis_1 ... done
</code></pre>
<blockquote>
<p>docker æ‰§è¡Œçš„æµç¨‹</p>
</blockquote>
<ol>
<li>
<p>åˆ›å»ºç½‘ç»œ</p>
</li>
<li>
<p>æ‰§è¡Œ<code>Docker-compose.yaml</code></p>
</li>
<li>
<p>å¯åŠ¨æœåŠ¡</p>
<ul>
<li>æ ¹æ®æ–‡ä»¶å<code>composetest</code>åˆ›å»ºæœåŠ¡</li>
</ul>
<pre><code class="hl language-yaml"><span class="hl-attr">version:</span> <span class="hl-string">"3.9"</span>
<span class="hl-attr">services:</span>
  <span class="hl-attr">web:</span>
    <span class="hl-attr">build:</span> <span class="hl-string">.</span>
    <span class="hl-attr">ports:</span>
      <span class="hl-bullet">-</span> <span class="hl-string">"5000:5000"</span>
  <span class="hl-attr">redis:</span>
    <span class="hl-attr">image:</span> <span class="hl-string">"redis:alpine"</span>
</code></pre>
</li>
</ol>
<h3 id="yaml-é…ç½®">yaml é…ç½®<a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#yaml-é…ç½®"></a></h3>
<blockquote>
<ul>
<li>ç¬¬ä¸€å±‚ï¼Œ<code>version</code>:ç¼–å†™æ–‡ä»¶æ ¼å¼å¯¹åº”çš„<a href="https://docs.docker.com/compose/compose-file/compose-file-v3/"><code>docker engine</code></a></li>
<li>ç¬¬äºŒå±‚ã€‚<code>services</code>:ç¼–å†™æ–‡ä»¶å¯¹åº”çš„æœåŠ¡ (å¯ä»¥æ— é™å¾€ä¸‹å†™)</li>
</ul>
</blockquote>
<pre><code class="hl language-yaml"><span class="hl-attr">services:</span>
  <span class="hl-attr">web:</span>
    <span class="hl-attr">build:</span> <span class="hl-string">.</span>
    <span class="hl-attr">ports:</span>
      <span class="hl-bullet">-</span> <span class="hl-string">"5000:5000"</span>
    <span class="hl-attr">images:</span>
    <span class="hl-string">...</span>
  <span class="hl-attr">redis:</span>
    <span class="hl-attr">image:</span> <span class="hl-string">"redis:alpine"</span>
    <span class="hl-string">...</span>
  <span class="hl-string">...</span>
</code></pre>
<blockquote>
<ul>
<li>ç¬¬ä¸‰å±‚ï¼šå…¶å®ƒé…ç½®ï¼Œç½‘ç»œå·ï¼Œå…¨å±€è§„åˆ™</li>
</ul>
</blockquote>
<pre><code class="hl language-yaml"><span class="hl-attr">volumes:</span>
<span class="hl-attr">networks:</span>
<span class="hl-attr">configs:</span>
</code></pre>
<h4 id="æ¯ä¸ªæœåŠ¡é‡Œçš„ç¼–å†™è§„åˆ™">æ¯ä¸ªæœåŠ¡é‡Œçš„ç¼–å†™è§„åˆ™<a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#æ¯ä¸ªæœåŠ¡é‡Œçš„ç¼–å†™è§„åˆ™"></a></h4>
<blockquote>
<p><code>build</code>ç”¨äºæœåŠ¡ä¸­æ„å»ºé¡¹ç›®</p>
</blockquote>
<ol>
<li>
<p><code>content</code>:æŒ‡å®šä¸ºåŒ…å«æ„å»ºä¸Šä¸‹æ–‡è·¯å¾„çš„å­—ç¬¦ä¸²</p>
</li>
<li>
<p><code>dockerfile</code>:æŒ‡å®šåœ¨ä¸Šä¸‹æ–‡ä¸­å¯é€‰çš„<code>Dockerfile</code></p>
</li>
<li>
<p><code>image: webapp:tag</code>:ç”Ÿæˆä¸€ä¸ªåä¸º webapp å¹¶æ ‡è®°ä¸º tag çš„é•œåƒ</p>
</li>
<li>
<p><code>cache_from</code>:ç”¨äºè§£æç¼“å­˜çš„é•œåƒ</p>
<pre><code class="hl language-yaml"><span class="hl-attr">build:</span>
  <span class="hl-attr">context:</span> <span class="hl-string">.</span>
  <span class="hl-attr">cache_from:</span>
    <span class="hl-bullet">-</span> <span class="hl-string">alpine:latest</span>
    <span class="hl-bullet">-</span> <span class="hl-string">corp/web_app:3.14</span>
</code></pre>
</li>
<li>
<p><code>network</code>RUN åœ¨æ„å»ºæœŸé—´è®¾ç½®å®¹å™¨è¿æ¥ç½‘ç»œ (å¦‚æœæ˜¯ noneï¼Œåˆ™ç¦æ­¢ç½‘ç»œ)</p>
</li>
</ol>
<blockquote>
<p><code>command</code>:</p>
</blockquote>
<ol>
<li>è¦†ç›–é»˜è®¤å‘½ä»¤ï¼š<code>command: bundle exec thin -p 3000</code></li>
<li>è¯¥å‘½ä»¤ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼š<code>command: ["bundle", "exec", "thin", "-p", "3000"]</code></li>
</ol>
<blockquote>
<p><code>container_name: my-web-container</code>æŒ‡å®šå®¹å™¨åç§°</p>
</blockquote>
<ul>
<li>å®¹å™¨åç§°å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œå› æ­¤å¦‚æœæ‚¨æŒ‡å®šäº†è‡ªå®šä¹‰åç§°ï¼Œåˆ™æ— æ³•å°†æœåŠ¡æ‰©å±•åˆ°è¶…è¿‡ 1
ä¸ªå®¹å™¨</li>
</ul>
<blockquote>
<p><code>depends_on</code>:è¡¨è¾¾æœåŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³» (yml ä¸­çš„æ–‡ä»¶ä»ä¸‹å¾€ä¸Šä¾æ¬¡æ‰§è¡Œï¼Œè¦æ³¨æ„é¡ºåº)</p>
</blockquote>
<pre><code class="hl language-yml"><span class="hl-attr">depends_on:</span>
  <span class="hl-bullet">-</span> <span class="hl-string">db</span>
  <span class="hl-bullet">-</span> <span class="hl-string">redis</span>
</code></pre>
<blockquote>
<p><code>deploy</code>:ä¸é›†ç¾¤ç›¸å…³çš„éƒ¨ç½²</p>
</blockquote>
<ul>
<li>å‚è€ƒ:<a href="https://docs.docker.com/compose/compose-file/compose-file-v3/#deploy">https://docs.docker.com/compose/compose-file/compose-file-v3/#deploy</a></li>
</ul>
<blockquote>
<p><code>entrypoint</code>:é»˜è®¤è¿›å…¥å®¹å™¨çš„å…¥å£</p>
</blockquote>
<ol>
<li>ç»ˆç«¯å½¢å¼ï¼š<code>entrypoint:/code/entrypoint.sh</code></li>
<li>åˆ—è¡¨ï¼š<code>entrypoint: ["php", "-d", "memory_limit=-1", "vendor/bin/phpunit"]</code></li>
</ol>
<blockquote>
<p><code>environment</code>:ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥è®¾ç½®æ•°æ®åº“è´¦å·å¯†ç ç­‰</p>
</blockquote>
<ol>
<li>å¦‚æœæ‚¨çš„æœåŠ¡æŒ‡å®šäº†æ„å»º environment é€‰é¡¹ï¼Œåˆ™åœ¨æ„å»ºæœŸé—´å®šä¹‰çš„å˜é‡ ä¸ä¼šè‡ªåŠ¨å¯è§ã€‚</li>
<li>ä½¿ç”¨ args å­é€‰é¡¹ build å®šä¹‰æ„å»ºçš„ç¯å¢ƒå˜é‡ã€‚å¯ä»¥ç›´æ¥åœ¨è¿™é‡Œè·å–</li>
</ol>
<pre><code class="hl language-yml"><span class="hl-attr">environment:</span>
  <span class="hl-bullet">-</span> <span class="hl-string">RACK_ENV=development</span>
  <span class="hl-bullet">-</span> <span class="hl-string">SHOW=true</span> <span class="hl-comment"># å¸ƒå°”å€¼ä¸ä¼šè¢«ç¼–è¯‘</span>
  <span class="hl-bullet">-</span> <span class="hl-string">SESSION_SECRET</span> <span class="hl-comment"># ä» args è·å–</span>
</code></pre>
<blockquote>
<p><code>expose</code>:å…¬å¼€ç«¯å£è€Œä¸å°†å®ƒä»¬å‘å¸ƒåˆ°ä¸»æœº -
å®ƒä»¬åªèƒ½è¢«é“¾æ¥æœåŠ¡è®¿é—®ã€‚åªèƒ½æŒ‡å®šå†…éƒ¨ç«¯å£</p>
</blockquote>
<pre><code class="hl language-yml"><span class="hl-attr">expose:</span>
  <span class="hl-bullet">-</span> <span class="hl-string">"3000"</span>
  <span class="hl-bullet">-</span> <span class="hl-string">"8000"</span>
</code></pre>
<blockquote>
<p><code>images</code>:æŒ‡å®šå¯åŠ¨å®¹å™¨çš„é•œåƒã€‚å¯ä»¥æ˜¯<code>å­˜å‚¨åº“/æ ‡ç­¾</code>æˆ–<code>é•œåƒID</code></p>
</blockquote>
<pre><code class="hl language-yml"><span class="hl-attr">image:</span> <span class="hl-string">ubuntu:18.04</span>
<span class="hl-attr">image:</span> <span class="hl-string">a4bc65fd</span>
</code></pre>
<blockquote>
<p><code>networks</code>:è¦åŠ å…¥çš„ç½‘ç»œï¼Œå¼•ç”¨é¡¶çº§<code>networkskey</code>ä¸‹çš„æ¡ç›®</p>
</blockquote>
<pre><code class="hl language-yml"><span class="hl-attr">services:</span>
  <span class="hl-attr">some-service:</span>
    <span class="hl-attr">networks:</span>
     <span class="hl-bullet">-</span> <span class="hl-string">some-network</span>
     <span class="hl-bullet">-</span> <span class="hl-string">other-network</span>
</code></pre>
<blockquote>
<p><code>ports</code>:æ˜ å°„çš„ç«¯å£å·ã€‚å¦‚æœæœ‰è¿™ä¸ª network_mode: host`,ä¸ä¼šå¯ç”¨</p>
</blockquote>
<ol>
<li>æŒ‡å®šä¸¤ä¸ªç«¯å£ (HOST:CONTAINER)</li>
<li>ä»…æŒ‡å®šå®¹å™¨ç«¯å£ (ä¸ºä¸»æœºç«¯å£é€‰æ‹©ä¸€ä¸ªä¸´æ—¶ä¸»æœºç«¯å£)</li>
<li>æŒ‡å®šè¦ç»‘å®šåˆ°ä¸¤ä¸ªç«¯å£çš„ä¸»æœº IP åœ°å€ï¼ˆé»˜è®¤ä¸º 0.0.0.0ï¼Œè¡¨ç¤ºæ‰€æœ‰æ¥å£ï¼‰ï¼š(
IPADDR:HOSTPORT:CONTAINERPORT)ã€‚å¦‚æœ HOSTPORT
ä¸ºç©ºï¼ˆä¾‹å¦‚ 127.0.0.1::80ï¼‰ï¼Œåˆ™é€‰æ‹©ä¸€ä¸ªä¸´æ—¶ç«¯å£æ¥ç»‘å®šåˆ°ä¸»æœºä¸Š</li>
</ol>
<ul>
<li><strong>ä½¿ç”¨é•¿è¯­æ³•</strong>:é•¿æ ¼å¼è¯­æ³•å…è®¸é…ç½®æ— æ³•ä»¥çŸ­æ ¼å¼è¡¨ç¤ºçš„é™„åŠ å­—æ®µã€‚
<ol>
<li><code>target</code>: å®¹å™¨å†…çš„ç«¯å£</li>
<li><code>published</code>: å…¬å¼€çš„ç«¯å£</li>
<li><code>protocol</code>ï¼šç«¯å£åè®®ï¼ˆtcp æˆ– udpï¼‰</li>
<li><code>mode</code>ï¼šhost ç”¨äºåœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šå‘å¸ƒä¸»æœºç«¯å£ï¼Œæˆ– ingress ç”¨äºé›†ç¾¤æ¨¡å¼ç«¯å£è¿›è¡Œè´Ÿè½½å¹³è¡¡</li>
</ol>
</li>
</ul>
<pre><code class="hl language-yml"><span class="hl-attr">ports:</span>
  <span class="hl-bullet">-</span> <span class="hl-attr">target:</span> <span class="hl-number">80</span>
    <span class="hl-attr">published:</span> <span class="hl-number">8080</span>
    <span class="hl-attr">protocol:</span> <span class="hl-string">tcp</span>
    <span class="hl-attr">mode:</span> <span class="hl-string">host</span>
</code></pre>
<blockquote>
<p><code>restart</code>:ä»€ä¹ˆæƒ…å†µä¸‹é‡å¯é¡¹ç›®</p>
</blockquote>
<ol>
<li><code>no</code>:é»˜è®¤çš„é‡å¯ç­–ç•¥ï¼Œåœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½ä¸é‡å¯å®¹å™¨ã€‚</li>
<li><code>always</code>:å®¹å™¨æ€»æ˜¯é‡æ–°å¯åŠ¨ã€‚</li>
<li><code>on-failure</code>:å¦‚æœé€€å‡ºä»£ç æŒ‡ç¤ºå‡ºç°æ•…éšœé”™è¯¯ï¼Œåˆ™è¯¥ ç­–ç•¥ä¼šé‡æ–°å¯åŠ¨å®¹å™¨ã€‚</li>
<li><code>unless-stopped</code>:æ€»æ˜¯é‡æ–°å¯åŠ¨å®¹å™¨ï¼Œé™¤éå®¹å™¨åœæ­¢ï¼ˆæ‰‹åŠ¨æˆ–å…¶ä»–æ–¹å¼ï¼‰</li>
</ol>
<blockquote>
<p><code>volumes</code>å¯ä»¥å°†ä¸»æœºè·¯å¾„æŒ‚è½½ä¸ºå•ä¸ªæœåŠ¡å®šä¹‰çš„ä¸€éƒ¨åˆ†ï¼Œæ— éœ€åœ¨é¡¶çº§ (ç¬¬ä¸‰å±‚)volumes é”®ä¸­å®šä¹‰å®ƒ</p>
</blockquote>
<ol>
<li>type: æŒ‚è½½ç±»å‹ volume, bind,tmpfs æˆ– npipe</li>
<li>source: æŒ‚è½½çš„æ¥æºï¼Œä¸»æœºä¸Šç”¨äºç»‘å®šæŒ‚è½½çš„è·¯å¾„ï¼Œæˆ–è€…åœ¨
é¡¶çº§ volumeskey ä¸­å®šä¹‰çš„å·çš„åç§°ã€‚ä¸é€‚ç”¨äº tmpfs æŒ‚è½½ã€‚</li>
<li>target: å®¹å™¨ä¸­å®‰è£…å·çš„è·¯å¾„</li>
<li>read_only: å°†å·è®¾ç½®ä¸ºåªè¯»çš„æ ‡å¿—</li>
<li>bind: é…ç½®é¢å¤–çš„ç»‘å®šé€‰é¡¹
<ul>
<li>propagationï¼šç”¨äºç»‘å®šçš„ä¼ æ’­æ¨¡å¼</li>
</ul>
</li>
<li>volumeï¼šé…ç½®é¢å¤–çš„éŸ³é‡é€‰é¡¹
<ul>
<li>nocopy: åˆ›å»ºå·æ—¶ç¦æ­¢ä»å®¹å™¨å¤åˆ¶æ•°æ®çš„æ ‡å¿—</li>
</ul>
</li>
<li>tmpfs: é…ç½®é¢å¤–çš„ tmpfs é€‰é¡¹
<ul>
<li>size: tmpfs æŒ‚è½½çš„å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰</li>
</ul>
</li>
</ol>
<pre><code class="hl language-yml"><span class="hl-attr">volumes:</span>
  <span class="hl-bullet">-</span> <span class="hl-attr">type:</span> <span class="hl-string">volume</span>
    <span class="hl-attr">source:</span> <span class="hl-string">mydata</span>
    <span class="hl-attr">target:</span> <span class="hl-string">/data</span>
    <span class="hl-attr">volume:</span>
      <span class="hl-attr">nocopy:</span> <span class="hl-literal">true</span>
  <span class="hl-bullet">-</span> <span class="hl-attr">type:</span> <span class="hl-string">bind</span>
    <span class="hl-attr">source:</span> <span class="hl-string">./static</span>
    <span class="hl-attr">target:</span> <span class="hl-string">/opt/app/static</span>
</code></pre>
<ul>
<li><strong>çŸ­è¯­æ³•</strong>:ç›´æ¥ä½¿ç”¨çŸ­è¯­æŒ‚è½½<code>data-volume:/var/lib/backup/data</code></li>
</ul>
<h4 id="network-é…ç½®">network é…ç½®<a class="anchor" aria-label="Anchor" aria-hidden="true" data-anchorjs-icon="ğŸ”—" href="#network-é…ç½®"></a></h4>
<pre><code class="hl language-yaml"><span class="hl-attr">networks:</span>
  <span class="hl-attr">network1:</span>
    <span class="hl-string">...</span>
  <span class="hl-attr">network2:</span>
    <span class="hl-string">...</span>
  <span class="hl-string">...</span>
</code></pre>
<blockquote>
<p><a href="https://docs.docker.com/compose/compose-file/compose-file-v3/#host-or-none"><code>driver</code></a>:æŒ‡å®šåº”ä¸ºæ­¤ç½‘ç»œä½¿ç”¨çš„é©±åŠ¨ç¨‹åº</p>
</blockquote>
<ol>
<li><code>bridge</code>:æ¡¥æ¥æ¨¡å¼ (docker é»˜è®¤)</li>
<li><code>overlay</code>:å‚è€ƒæ–‡æ¡£</li>
<li><code>host</code>å’Œ<code>none</code>:å’Œä¸»æœºå…±äº«ç½‘ç»œæˆ–è€…ä¸é…ç½®ç½‘ç»œ</li>
</ol>
<blockquote>
<p><code>external</code>:å¦‚æœè®¾ç½®ä¸º trueï¼Œåˆ™æŒ‡å®šæ­¤ç½‘ç»œæ˜¯åœ¨ Compose ä¹‹å¤–åˆ›å»ºçš„</p>
</blockquote>
<pre><code class="hl language-yml"><span class="hl-attr">networks:</span>
  <span class="hl-attr">outside:</span>
    <span class="hl-attr">external:</span> <span class="hl-literal">true</span>
</code></pre>
<blockquote>
<p><code>name</code>:ä¸ºæ­¤ç½‘ç»œè®¾ç½®è‡ªå®šä¹‰åç§°</p>
</blockquote>
<pre><code class="hl language-yaml"><span class="hl-comment"># ä¸åˆ›å»ºæ–°ç½‘ç»œï¼ŒåŠ å…¥å·²å­˜åœ¨çš„ç½‘ç»œ</span>
<span class="hl-attr">networks:</span>
  <span class="hl-attr">network1:</span> <span class="hl-literal">true</span>
  <span class="hl-attr">name:</span> <span class="hl-string">my-app-net</span>
</code></pre>
        </article></main><script src="https://giscus.app/client.js"
        data-repo="fwqaaq/fwqaaq.github.io"
        data-repo-id="R_kgDOHCFK2A"
        data-category="Show and tell"
        data-category-id="DIC_kwDOHCFK2M4CYOLh"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="1"
        data-input-position="bottom"
        data-theme="preferred_color_scheme"
        data-lang="zh-CN"
        crossorigin="anonymous"
        async></script>